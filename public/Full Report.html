<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Full Scan Report</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial,
          sans-serif;
        background: linear-gradient(
          135deg,
          #0f1923 0%,
          #1a2a3a 50%,
          #0f1923 100%
        );
        color: #e0e0e0;
        min-height: 100vh;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(
            circle at 20% 80%,
            rgba(247, 147, 30, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(0, 212, 255, 0.03) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: -1;
      }

      /* Loading Screen */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #0f1923;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition:
          opacity 0.5s,
          visibility 0.5s;
      }

      .loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
      }

      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(247, 147, 30, 0.2);
        border-top-color: #f7931e;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .loading-text {
        margin-top: 20px;
        color: #f7931e;
        font-size: 1.2rem;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .header {
        background: linear-gradient(
          135deg,
          #0a1218 0%,
          #152535 50%,
          #0d1a26 100%
        );
        padding: 20px 40px;
        border-bottom: 3px solid;
        border-image: linear-gradient(90deg, #f7931e, #ff6b35, #f7931e) 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
        position: sticky;
        top: 0;
        z-index: 100;
        animation: slideDown 0.6s ease-out;
        flex-wrap: wrap;
      }

      @keyframes slideDown {
        from {
          transform: translateY(-100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Scroll offset for anchor links */
      :target {
        scroll-margin-top: 120px;
      }

      [id] {
        scroll-margin-top: 120px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .logo {
        font-size: 1.8rem;
        font-weight: 700;
        background: linear-gradient(135deg, #f7931e, #ffb347);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: glow 2s ease-in-out infinite alternate;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      @keyframes glow {
        from {
          filter: drop-shadow(0 0 5px rgba(247, 147, 30, 0.5));
        }
        to {
          filter: drop-shadow(0 0 15px rgba(247, 147, 30, 0.8));
        }
      }

      .header-title {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .header-title h1 {
        font-size: 1.1rem;
        font-weight: 500;
        color: #8899a6;
        margin: 0;
        white-space: nowrap;
      }

      .header-title .target-name {
        font-size: 1.2rem;
        font-weight: 700;
        color: #fff;
        padding: 6px 16px;
        background: linear-gradient(
          135deg,
          rgba(247, 147, 30, 0.15),
          rgba(255, 107, 53, 0.1)
        );
        border-radius: 8px;
        border: 1px solid rgba(247, 147, 30, 0.3);
        animation: targetPulse 2s ease-in-out infinite;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .header-title .target-name::before {
        content: "ðŸŽ¯";
        font-size: 0.9rem;
      }

      @keyframes targetPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(247, 147, 30, 0.4);
        }
        50% {
          box-shadow: 0 0 0 8px rgba(247, 147, 30, 0);
        }
      }

      .header-right {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 10px;
      }

      .header-meta {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 4px;
      }

      .header-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.8rem;
        color: #8899a6;
        background: rgba(255, 255, 255, 0.03);
        padding: 4px 12px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .header-meta-item .icon {
        font-size: 0.75rem;
        opacity: 0.7;
      }

      .header-meta-item .value {
        color: #b8c5d0;
        font-family: monospace;
        font-size: 0.75rem;
      }

      .header-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .header-btn {
        background: linear-gradient(
          135deg,
          rgba(247, 147, 30, 0.1),
          rgba(255, 107, 53, 0.05)
        );
        border: 1px solid rgba(247, 147, 30, 0.3);
        color: #f7931e;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }

      .header-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(247, 147, 30, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
      }

      .header-btn:hover::before {
        width: 200px;
        height: 200px;
      }

      .header-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(247, 147, 30, 0.25),
          rgba(255, 107, 53, 0.15)
        );
        border-color: #f7931e;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.3);
        color: #ffb347;
      }

      .header-btn:active {
        transform: translateY(0);
      }

      .header-btn span {
        position: relative;
        z-index: 1;
      }

      /* Header divider */
      .header-divider {
        width: 1px;
        height: 40px;
        background: linear-gradient(
          180deg,
          transparent,
          rgba(247, 147, 30, 0.3),
          transparent
        );
        margin: 0 10px;
      }

      @media (max-width: 1024px) {
        .header {
          padding: 16px 24px;
        }

        .header-left {
          gap: 12px;
        }

        .logo {
          font-size: 1.5rem;
        }

        .header-title h1 {
          font-size: 1rem;
        }

        .header-title .target-name {
          font-size: 1rem;
          padding: 5px 12px;
        }

        .header-divider {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: stretch;
          gap: 16px;
          padding: 16px 20px;
        }

        .header-left {
          justify-content: center;
        }

        .header-title {
          flex-direction: column;
          align-items: center;
          text-align: center;
        }

        .header-right {
          align-items: center;
        }

        .header-meta {
          align-items: center;
        }

        .header-actions {
          justify-content: center;
        }
      }

      .header-btn {
        background: rgba(247, 147, 30, 0.1);
        border: 1px solid rgba(247, 147, 30, 0.3);
        color: #f7931e;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .header-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(247, 147, 30, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
      }

      .header-btn:hover::before {
        width: 200px;
        height: 200px;
      }

      .header-btn:hover {
        background: rgba(247, 147, 30, 0.2);
        border-color: #f7931e;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(247, 147, 30, 0.3);
      }

      .header-btn:active {
        transform: translateY(0);
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 30px 40px;
      }

      /* Quick Navigation - ENHANCED */
      .quick-nav {
        position: fixed;
        right: 24px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(
          145deg,
          rgba(13, 26, 38, 0.95),
          rgba(21, 37, 53, 0.95)
        );
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 16px;
        padding: 16px 12px;
        z-index: 50;
        display: flex;
        flex-direction: column;
        gap: 4px;
        animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        backdrop-filter: blur(20px);
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.05) inset,
          0 0 30px rgba(247, 147, 30, 0.1);
      }

      .quick-nav::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #f7931e, #ff6b35, #f7931e);
        border-radius: 16px 16px 0 0;
        opacity: 0.8;
      }

      .quick-nav::after {
        content: "âš¡";
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #f7931e, #ff6b35);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.5);
        animation: navIconPulse 2s ease-in-out infinite;
      }

      @keyframes navIconPulse {
        0%,
        100% {
          transform: translateX(-50%) scale(1);
          box-shadow: 0 4px 15px rgba(247, 147, 30, 0.5);
        }
        50% {
          transform: translateX(-50%) scale(1.1);
          box-shadow: 0 6px 25px rgba(247, 147, 30, 0.7);
        }
      }

      @keyframes slideInRight {
        from {
          transform: translateY(-50%) translateX(100px);
          opacity: 0;
        }
        to {
          transform: translateY(-50%) translateX(0);
          opacity: 1;
        }
      }

      .quick-nav-title {
        font-size: 0.6rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #f7931e;
        text-align: center;
        padding: 8px 0 12px 0;
        border-bottom: 1px solid rgba(247, 147, 30, 0.2);
        margin-bottom: 8px;
        font-weight: 600;
      }

      .quick-nav a {
        color: #8899a6;
        text-decoration: none;
        font-size: 0.75rem;
        padding: 10px 14px;
        border-radius: 10px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
        position: relative;
        display: flex;
        align-items: center;
        gap: 10px;
        overflow: hidden;
      }

      .quick-nav a .nav-icon {
        font-size: 1rem;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        transition: all 0.3s;
        flex-shrink: 0;
      }

      .quick-nav a .nav-text {
        opacity: 0;
        max-width: 0;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
      }

      .quick-nav:hover a .nav-text {
        opacity: 1;
        max-width: 100px;
        margin-left: 0;
      }

      .quick-nav a::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 3px;
        height: 100%;
        background: linear-gradient(180deg, #f7931e, #ff6b35);
        opacity: 0;
        transition: opacity 0.3s;
        border-radius: 0 3px 3px 0;
      }

      .quick-nav a::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(
          circle,
          rgba(247, 147, 30, 0.3),
          transparent 70%
        );
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.4s;
        z-index: -1;
      }

      .quick-nav a:hover {
        background: rgba(247, 147, 30, 0.1);
        color: #f7931e;
        transform: translateX(-4px);
        padding-left: 18px;
      }

      .quick-nav a:hover::before {
        opacity: 1;
      }

      .quick-nav a:hover::after {
        width: 100px;
        height: 100px;
      }

      .quick-nav a:hover .nav-icon {
        background: rgba(247, 147, 30, 0.2);
        transform: scale(1.1) rotate(5deg);
        color: #f7931e;
      }

      .quick-nav a.active {
        background: linear-gradient(
          135deg,
          rgba(247, 147, 30, 0.2),
          rgba(255, 107, 53, 0.1)
        );
        color: #f7931e;
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.2);
      }

      .quick-nav a.active::before {
        opacity: 1;
      }

      .quick-nav a.active .nav-icon {
        background: linear-gradient(135deg, #f7931e, #ff6b35);
        color: #000;
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.4);
      }

      /* Progress indicator on nav */
      .quick-nav-progress {
        position: absolute;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
      }

      .quick-nav-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #f7931e, #ff6b35);
        border-radius: 2px;
        width: 0%;
        transition: width 0.3s;
      }

      /* Tooltip on hover */
      .quick-nav a[data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        right: calc(100% + 10px);
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: #fff;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.75rem;
        white-space: nowrap;
        z-index: 100;
        border: 1px solid rgba(247, 147, 30, 0.3);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        width: auto;
        height: auto;
        background-image: none;
        border-radius: 6px;
      }
      .quick-nav a[data-tooltip]:hover::after {
        display: none !important;
      }
      /* Minimize button */
      .quick-nav-toggle {
        position: absolute;
        top: 50%;
        left: -12px;
        transform: translateY(-50%);
        width: 24px;
        height: 48px;
        background: linear-gradient(
          145deg,
          rgba(13, 26, 38, 0.95),
          rgba(21, 37, 53, 0.95)
        );
        border: 1px solid rgba(247, 147, 30, 0.3);
        border-right: none;
        border-radius: 8px 0 0 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #f7931e;
        font-size: 0.8rem;
        transition: all 0.3s;
        opacity: 0;
      }

      .quick-nav:hover .quick-nav-toggle {
        opacity: 1;
      }

      .quick-nav-toggle:hover {
        background: rgba(247, 147, 30, 0.2);
        width: 28px;
      }

      .quick-nav.minimized {
        padding: 12px 8px;
        border-radius: 12px;
      }

      .quick-nav.minimized .nav-text,
      .quick-nav.minimized .quick-nav-title,
      .quick-nav.minimized .quick-nav-progress {
        display: none;
      }

      .quick-nav.minimized a {
        padding: 8px;
        justify-content: center;
      }

      .quick-nav.minimized:hover a .nav-text {
        display: none;
      }

      @media (max-width: 1400px) {
        .quick-nav {
          display: none;
        }
      }

      /* Search Bar - ENHANCED */
      .search-bar {
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 12px;
        padding: 20px 24px;
        margin-bottom: 30px;
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
        animation: fadeInUp 0.6s ease-out;
        transition: all 0.3s;
      }

      .search-bar:focus-within {
        border-color: #f7931e;
        box-shadow: 0 0 20px rgba(247, 147, 30, 0.2);
      }

      .search-container {
        flex: 1;
        min-width: 300px;
        position: relative;
      }

      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.1rem;
        color: #666;
        transition: all 0.3s;
        pointer-events: none;
        z-index: 2;
      }

      .search-container:focus-within .search-icon {
        color: #f7931e;
        transform: translateY(-50%) scale(1.1);
        animation: searchIconPulse 0.5s ease-out;
      }

      @keyframes searchIconPulse {
        0% {
          transform: translateY(-50%) scale(1);
        }
        50% {
          transform: translateY(-50%) scale(1.3);
        }
        100% {
          transform: translateY(-50%) scale(1.1);
        }
      }

      .search-input {
        width: 100%;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 14px 16px 14px 48px;
        color: #fff;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .search-input::placeholder {
        color: #666;
        transition: all 0.3s;
      }

      .search-input:focus {
        outline: none;
        border-color: #f7931e;
        background: rgba(0, 0, 0, 0.5);
        box-shadow: 0 0 0 4px rgba(247, 147, 30, 0.1);
      }

      .search-input:focus::placeholder {
        color: #888;
      }

      /* Search Suggestions Dropdown */
      .search-suggestions {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.3);
        border-radius: 12px;
        max-height: 350px;
        overflow-y: auto;
        z-index: 9999;
        display: none;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        animation: dropdownSlide 0.3s ease-out;
      }

      @keyframes dropdownSlide {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .search-suggestions.visible {
        display: block;
      }

      .search-suggestions-header {
        padding: 12px 16px;
        font-size: 0.75rem;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .search-suggestions-header .close-btn {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        font-size: 1rem;
        padding: 4px;
        transition: all 0.2s;
      }

      .search-suggestions-header .close-btn:hover {
        color: #f44336;
        transform: scale(1.2);
      }

      .suggestion-item {
        padding: 12px 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.02);
        position: relative;
        overflow: hidden;
      }

      .suggestion-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 3px;
        height: 100%;
        background: var(--suggestion-color, #f7931e);
        opacity: 0;
        transition: opacity 0.2s;
      }

      .suggestion-item:hover {
        background: rgba(247, 147, 30, 0.1);
        padding-left: 24px;
      }

      .suggestion-item:hover::before {
        opacity: 1;
      }

      .suggestion-item.selected {
        background: rgba(247, 147, 30, 0.15);
        padding-left: 24px;
      }

      .suggestion-item.selected::before {
        opacity: 1;
      }

      .suggestion-icon {
        font-size: 1.2rem;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        flex-shrink: 0;
        transition: all 0.3s;
      }

      .suggestion-item:hover .suggestion-icon {
        transform: scale(1.1);
        background: rgba(247, 147, 30, 0.2);
      }

      .suggestion-content {
        flex: 1;
        min-width: 0;
      }

      .suggestion-title {
        color: #fff;
        font-size: 0.9rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .suggestion-title .highlight {
        background: rgba(247, 147, 30, 0.3);
        color: #f7931e;
        padding: 1px 4px;
        border-radius: 3px;
      }

      .suggestion-meta {
        color: #666;
        font-size: 0.75rem;
        margin-top: 2px;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .suggestion-type {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.05);
        color: #aaa;
      }

      .suggestion-category {
        padding: 10px 16px;
        font-size: 0.7rem;
        color: #f7931e;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: rgba(247, 147, 30, 0.05);
        border-top: 1px solid rgba(247, 147, 30, 0.1);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .suggestion-category::before {
        content: "";
        width: 20px;
        height: 1px;
        background: linear-gradient(90deg, #f7931e, transparent);
      }

      .recent-searches {
        padding: 8px 16px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .recent-search-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        color: #aaa;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .recent-search-item:hover {
        background: rgba(247, 147, 30, 0.15);
        border-color: rgba(247, 147, 30, 0.3);
        color: #f7931e;
      }

      .recent-search-item .remove {
        opacity: 0;
        transition: opacity 0.2s;
        font-size: 0.7rem;
      }

      .recent-search-item:hover .remove {
        opacity: 1;
      }

      .no-suggestions {
        padding: 30px;
        text-align: center;
        color: #666;
      }

      .no-suggestions-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        opacity: 0.5;
      }

      .search-loading {
        position: absolute;
        right: 45px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        display: none;
      }

      .search-loading.visible {
        display: block;
      }

      .search-loading::after {
        content: "";
        position: absolute;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(247, 147, 30, 0.2);
        border-top-color: #f7931e;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      .search-clear {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: #888;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        transition: all 0.2s;
        z-index: 2;
      }

      .search-clear.visible {
        display: flex;
        animation: scaleIn 0.2s ease-out;
      }

      .search-clear:hover {
        background: rgba(244, 67, 54, 0.3);
        color: #f44336;
        transform: translateY(-50%) scale(1.1);
      }

      .search-results-count {
        position: absolute;
        right: 45px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.75rem;
        color: #f7931e;
        background: rgba(247, 147, 30, 0.1);
        padding: 4px 8px;
        border-radius: 4px;
        display: none;
        z-index: 2;
      }

      .search-results-count.visible {
        display: block;
        animation: fadeIn 0.3s ease-out;
      }

      .keyboard-hint {
        position: absolute;
        right: 80px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        gap: 4px;
        opacity: 0.5;
        transition: opacity 0.3s;
        z-index: 1;
      }

      .keyboard-hint.hidden {
        opacity: 0;
      }

      .search-input:focus ~ .keyboard-hint {
        opacity: 0;
      }

      .kbd {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.65rem;
        color: #888;
        font-family: monospace;
      }

      .filter-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .filter-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #aaa;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .filter-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(247, 147, 30, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .filter-btn:hover::before {
        left: 100%;
      }

      .filter-btn:hover {
        background: rgba(247, 147, 30, 0.1);
        border-color: rgba(247, 147, 30, 0.5);
        color: #f7931e;
        transform: translateY(-2px);
      }

      .filter-btn.active {
        background: linear-gradient(
          135deg,
          rgba(247, 147, 30, 0.2),
          rgba(255, 107, 53, 0.2)
        );
        border-color: #f7931e;
        color: #f7931e;
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.3);
      }

      .filter-btn .count {
        background: rgba(0, 0, 0, 0.3);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
        margin-left: 6px;
      }

      /* Summary Cards */
      .summary-row {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .summary-card {
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .summary-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--card-color, #f7931e);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .summary-card::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(247, 147, 30, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
      }

      .summary-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border-color: rgba(247, 147, 30, 0.5);
      }

      .summary-card:hover::before {
        opacity: 1;
      }

      .summary-card:hover::after {
        opacity: 1;
      }

      .summary-card .icon {
        font-size: 2rem;
        margin-bottom: 12px;
        display: block;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .summary-card:hover .icon {
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: rotate(0);
        }
        25% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(10deg);
        }
      }

      .summary-value {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #f7931e, #ffb347);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .summary-label {
        font-size: 0.8rem;
        color: #8899a6;
        text-transform: uppercase;
        margin-top: 8px;
        letter-spacing: 1px;
      }

      .counter {
        display: inline-block;
      }

      .progress-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-top: 12px;
      }

      .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Risk Score */
      .risk-score-section {
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 40px;
        animation: fadeInUp 0.6s ease-out 0.2s both;
      }

      .risk-gauge {
        position: relative;
        width: 200px;
        height: 100px;
        flex-shrink: 0;
      }

      .risk-gauge canvas {
        width: 100%;
        height: 100%;
      }

      .risk-score-value {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
      }

      .risk-score-value .score {
        font-size: 2.5rem;
        font-weight: 700;
        transition: all 0.5s;
      }

      .risk-score-value .label {
        font-size: 0.8rem;
        color: #888;
        text-transform: uppercase;
      }

      .risk-details {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
      }

      .risk-item {
        text-align: center;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        transition: all 0.3s;
        cursor: pointer;
      }

      .risk-item:hover {
        transform: scale(1.05);
        background: rgba(0, 0, 0, 0.3);
      }

      .risk-item .count {
        font-size: 1.8rem;
        font-weight: 700;
      }

      .risk-item .label {
        font-size: 0.75rem;
        color: #888;
        text-transform: uppercase;
        margin-top: 4px;
      }

      .risk-critical .count {
        color: #f44336;
      }
      .risk-high .count {
        color: #ff9800;
      }
      .risk-medium .count {
        color: #ffc107;
      }
      .risk-low .count {
        color: #4caf50;
      }

      /* Section Headers */
      .section-header {
        background: linear-gradient(
          90deg,
          #f7931e 0%,
          #ff6b35 50%,
          #f7931e 100%
        );
        background-size: 200% 100%;
        color: #000;
        padding: 12px 20px;
        font-weight: 700;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-radius: 8px 8px 0 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        animation: gradientFlow 4s ease infinite;
        position: relative;
        overflow: hidden;
      }

      .section-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        animation: headerShine 3s infinite;
      }

      @keyframes headerShine {
        0% {
          left: -100%;
        }
        50%,
        100% {
          left: 100%;
        }
      }

      .section-header .left {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-header .left::before {
        content: "";
        width: 8px;
        height: 8px;
        background: #000;
        border-radius: 50%;
        animation: dotPulse 1.5s infinite;
      }

      @keyframes dotPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.3);
          opacity: 0.7;
        }
      }

      .section-header .count-badge {
        background: rgba(0, 0, 0, 0.2);
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.8rem;
      }

      .section-header .actions {
        display: flex;
        gap: 8px;
      }

      .section-header .action-btn {
        background: rgba(0, 0, 0, 0.2);
        border: none;
        color: #000;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .section-header .action-btn:hover {
        background: rgba(0, 0, 0, 0.3);
        transform: scale(1.05);
      }

      @keyframes gradientFlow {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      /* Panels */
      .panel {
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 0 0 8px 8px;
        margin-bottom: 30px;
        overflow: hidden;
        animation: fadeInUp 0.6s ease-out;
      }

      .two-columns {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .three-columns {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .chart-panel {
        padding: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 350px;
      }

      .chart-wrapper {
        display: flex;
        align-items: center;
        gap: 40px;
        width: 100%;
        justify-content: center;
      }

      .chart-container {
        position: relative;
        width: 280px;
        height: 280px;
      }

      .chart-legend {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 280px;
        overflow-y: auto;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.85rem;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .legend-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background: var(--legend-color, #f7931e);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .legend-item:hover {
        background: rgba(247, 147, 30, 0.1);
        transform: translateX(8px);
      }

      .legend-item:hover::before {
        opacity: 1;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        flex-shrink: 0;
        transition: transform 0.3s;
      }

      .legend-item:hover .legend-color {
        transform: scale(1.2);
      }

      .legend-label {
        flex: 1;
        text-transform: capitalize;
      }

      .legend-count {
        font-weight: 700;
        color: #f7931e;
      }

      .legend-percent {
        font-size: 0.75rem;
        color: #666;
        margin-left: 5px;
      }

      /* Tables */
      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead th {
        background: linear-gradient(180deg, #1a2d3d, #152535);
        color: #f7931e;
        padding: 14px 16px;
        text-align: left;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 2px solid rgba(247, 147, 30, 0.3);
        position: sticky;
        top: 0;
        z-index: 10;
        cursor: pointer;
        user-select: none;
        transition: all 0.3s;
      }

      thead th:hover {
        background: linear-gradient(180deg, #243d4d, #1a3545);
        color: #ffb347;
      }

      thead th .sort-icon {
        margin-left: 5px;
        opacity: 0.5;
        transition: all 0.3s;
      }

      thead th:hover .sort-icon {
        opacity: 1;
      }

      thead th.sorted .sort-icon {
        opacity: 1;
        color: #fff;
      }

      tbody td {
        padding: 12px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        font-size: 0.85rem;
        transition: all 0.2s;
      }

      tbody tr {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        animation: tableRowSlide 0.4s ease-out forwards;
      }

      @keyframes tableRowSlide {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      tbody tr:hover {
        background: rgba(247, 147, 30, 0.08);
        transform: scale(1.005);
      }

      tbody tr:nth-child(even) {
        background: rgba(0, 0, 0, 0.2);
      }

      tbody tr:nth-child(even):hover {
        background: rgba(247, 147, 30, 0.12);
      }

      tbody tr.highlighted {
        background: rgba(247, 147, 30, 0.2) !important;
        border-left: 3px solid #f7931e;
        animation:
          highlightPulse 1s ease-in-out,
          highlightGlow 2s ease-in-out infinite;
      }

      @keyframes highlightPulse {
        0%,
        100% {
          background: rgba(247, 147, 30, 0.2);
        }
        50% {
          background: rgba(247, 147, 30, 0.35);
        }
      }

      @keyframes highlightGlow {
        0%,
        100% {
          box-shadow: inset 0 0 10px rgba(247, 147, 30, 0.1);
        }
        50% {
          box-shadow: inset 0 0 20px rgba(247, 147, 30, 0.2);
        }
      }

      tbody tr.hidden-row {
        display: none;
      }

      .scrollable-table {
        max-height: 400px;
        overflow-y: auto;
      }

      .expandable-row {
        cursor: pointer;
      }

      .row-details {
        display: none;
        background: rgba(0, 0, 0, 0.3);
        padding: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        animation: expandRow 0.3s ease-out;
      }

      @keyframes expandRow {
        from {
          opacity: 0;
          max-height: 0;
        }
        to {
          opacity: 1;
          max-height: 500px;
        }
      }

      .row-details.visible {
        display: block;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .detail-item {
        background: rgba(255, 255, 255, 0.02);
        padding: 12px;
        border-radius: 6px;
      }

      .detail-item .label {
        font-size: 0.75rem;
        color: #888;
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      .detail-item .value {
        color: #fff;
        font-size: 0.9rem;
      }

      /* Status Badges */
      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        transition: all 0.3s;
      }

      .status-badge:hover {
        transform: scale(1.05);
      }

      .status-200 {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
      }
      .status-301,
      .status-302 {
        background: rgba(33, 150, 243, 0.2);
        color: #2196f3;
        border: 1px solid rgba(33, 150, 243, 0.3);
      }
      .status-400 {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
      }
      .status-403,
      .status-404 {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
      }
      .status-500 {
        background: rgba(156, 39, 176, 0.2);
        color: #9c27b0;
        border: 1px solid rgba(156, 39, 176, 0.3);
      }
      .status-null {
        background: rgba(158, 158, 158, 0.2);
        color: #9e9e9e;
        border: 1px solid rgba(158, 158, 158, 0.3);
      }

      /* Security Badges */
      .security-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        margin: 2px;
        transition: all 0.3s;
      }

      .security-badge:hover {
        transform: translateY(-2px);
      }

      .security-good {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
      }
      .security-warning {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
      }
      .security-bad {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
      }
      .security-info {
        background: rgba(33, 150, 243, 0.2);
        color: #2196f3;
      }

      /* Tech Badges */
      .tech-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        background: linear-gradient(
          135deg,
          rgba(156, 39, 176, 0.2),
          rgba(103, 58, 183, 0.2)
        );
        color: #ce93d8;
        border: 1px solid rgba(156, 39, 176, 0.3);
        margin: 4px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .tech-badge:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);
        background: linear-gradient(
          135deg,
          rgba(156, 39, 176, 0.3),
          rgba(103, 58, 183, 0.3)
        );
      }

      /* Type Indicator */
      .type-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .type-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        flex-shrink: 0;
        box-shadow: 0 0 6px currentColor;
        animation: dotGlow 2s infinite alternate;
      }

      @keyframes dotGlow {
        from {
          box-shadow: 0 0 4px currentColor;
        }
        to {
          box-shadow: 0 0 12px currentColor;
        }
      }

      /* IP Badge */
      .ip-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-family: monospace;
        background: rgba(255, 152, 0, 0.1);
        color: #ff9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
        margin: 4px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .ip-badge:hover {
        background: rgba(255, 152, 0, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
      }

      /* CDN Badge */
      .cdn-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        margin: 2px;
        transition: all 0.3s;
      }

      .cdn-badge:hover {
        transform: translateY(-2px);
      }

      .cdn-cloudflare {
        background: linear-gradient(
          135deg,
          rgba(245, 130, 32, 0.2),
          rgba(245, 130, 32, 0.1)
        );
        color: #f58220;
        border: 1px solid rgba(245, 130, 32, 0.4);
      }

      .cdn-google {
        background: linear-gradient(
          135deg,
          rgba(66, 133, 244, 0.2),
          rgba(66, 133, 244, 0.1)
        );
        color: #4285f4;
        border: 1px solid rgba(66, 133, 244, 0.4);
      }

      .cdn-aws {
        background: linear-gradient(
          135deg,
          rgba(255, 153, 0, 0.2),
          rgba(255, 153, 0, 0.1)
        );
        color: #ff9900;
        border: 1px solid rgba(255, 153, 0, 0.4);
      }

      .cdn-akamai {
        background: linear-gradient(
          135deg,
          rgba(0, 151, 215, 0.2),
          rgba(0, 151, 215, 0.1)
        );
        color: #0097d7;
        border: 1px solid rgba(0, 151, 215, 0.4);
      }

      .cdn-fastly {
        background: linear-gradient(
          135deg,
          rgba(255, 40, 72, 0.2),
          rgba(255, 40, 72, 0.1)
        );
        color: #ff2848;
        border: 1px solid rgba(255, 40, 72, 0.4);
      }

      .cdn-nginx {
        background: linear-gradient(
          135deg,
          rgba(0, 150, 57, 0.2),
          rgba(0, 150, 57, 0.1)
        );
        color: #009639;
        border: 1px solid rgba(0, 150, 57, 0.4);
      }

      .cdn-apache {
        background: linear-gradient(
          135deg,
          rgba(209, 35, 42, 0.2),
          rgba(209, 35, 42, 0.1)
        );
        color: #d1232a;
        border: 1px solid rgba(209, 35, 42, 0.4);
      }

      .cdn-envoy {
        background: linear-gradient(
          135deg,
          rgba(172, 110, 255, 0.2),
          rgba(172, 110, 255, 0.1)
        );
        color: #ac6eff;
        border: 1px solid rgba(172, 110, 255, 0.4);
      }

      .cdn-default {
        background: rgba(255, 255, 255, 0.05);
        color: #aaa;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Protocol Badge */
      .protocol-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .protocol-h3 {
        background: rgba(0, 212, 255, 0.2);
        color: #00d4ff;
        border: 1px solid rgba(0, 212, 255, 0.3);
      }

      .protocol-h2 {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
      }

      .protocol-quic {
        background: rgba(156, 39, 176, 0.2);
        color: #ce93d8;
        border: 1px solid rgba(156, 39, 176, 0.3);
      }

      /* HSTS Duration Badge */
      .hsts-duration {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-family: monospace;
      }

      .hsts-strong {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
      }

      .hsts-medium {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
      }

      .hsts-weak {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
      }

      /* CORS Value Display */
      .cors-value {
        font-family: monospace;
        font-size: 0.8rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        cursor: pointer;
      }

      .cors-value:hover {
        background: rgba(247, 147, 30, 0.1);
        overflow: visible;
        white-space: normal;
        word-break: break-all;
      }

      .cors-wildcard {
        color: #f44336;
        font-weight: 600;
      }

      .cors-restricted {
        color: #4caf50;
      }

      /* Cache Value */
      .cache-value {
        font-family: monospace;
        font-size: 0.75rem;
        max-width: 180px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .etag-value {
        font-family: monospace;
        font-size: 0.75rem;
        color: #888;
        max-width: 150px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Permissions Policy */
      .permission-item {
        display: inline-block;
        padding: 2px 6px;
        margin: 2px;
        border-radius: 3px;
        font-size: 0.7rem;
        background: rgba(255, 255, 255, 0.05);
        color: #888;
      }

      .permission-blocked {
        background: rgba(76, 175, 80, 0.15);
        color: #4caf50;
      }

      .permission-allowed {
        background: rgba(255, 152, 0, 0.15);
        color: #ff9800;
      }

      /* Tooltip */
      .tooltip {
        position: fixed;
        background: rgba(0, 0, 0, 0.95);
        color: #fff;
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 0.8rem;
        max-width: 300px;
        z-index: 10000;
        pointer-events: none;
        opacity: 0;
        transition:
          opacity 0.2s,
          transform 0.2s;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(247, 147, 30, 0.3);
        transform: translateY(10px);
      }

      .tooltip.visible {
        opacity: 1;
        transform: translateY(0);
      }

      /* Header Key-Value */
      .header-item {
        display: flex;
        padding: 10px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        font-size: 0.85rem;
        transition: all 0.3s;
      }

      .header-item:hover {
        background: rgba(247, 147, 30, 0.08);
        padding-left: 24px;
      }

      .header-key {
        min-width: 250px;
        color: #f7931e;
        font-weight: 500;
      }

      .header-value {
        flex: 1;
        color: #aaa;
        word-break: break-all;
        font-family: monospace;
        font-size: 0.8rem;
      }

      .header-value .copy-btn {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        padding: 2px 6px;
        margin-left: 8px;
        font-size: 0.75rem;
        opacity: 0;
        transition: all 0.2s;
      }

      .header-item:hover .copy-btn {
        opacity: 1;
      }

      .copy-btn:hover {
        color: #f7931e;
        transform: scale(1.2);
      }

      /* Cookie Item */
      .cookie-item {
        padding: 14px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s;
      }

      .cookie-item:hover {
        background: rgba(247, 147, 30, 0.08);
        padding-left: 24px;
      }

      .cookie-name {
        color: #f7931e;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .cookie-flags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      /* Timeline */
      .timeline-section {
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.2);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        animation: fadeInUp 0.6s ease-out 0.3s both;
      }

      .timeline {
        display: flex;
        align-items: center;
        gap: 20px;
        overflow-x: auto;
        padding: 20px 0;
      }

      .timeline-item {
        flex-shrink: 0;
        text-align: center;
        position: relative;
        animation: fadeInUp 0.5s ease-out both;
      }

      .timeline-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .timeline-item:nth-child(2) {
        animation-delay: 0.2s;
      }
      .timeline-item:nth-child(3) {
        animation-delay: 0.3s;
      }
      .timeline-item:nth-child(4) {
        animation-delay: 0.4s;
      }
      .timeline-item:nth-child(5) {
        animation-delay: 0.5s;
      }

      .timeline-item::after {
        content: "";
        position: absolute;
        top: 20px;
        left: 100%;
        width: 60px;
        height: 2px;
        background: linear-gradient(
          90deg,
          rgba(247, 147, 30, 0.5),
          rgba(247, 147, 30, 0.1)
        );
        animation: lineGrow 0.5s ease-out 0.5s both;
      }

      @keyframes lineGrow {
        from {
          width: 0;
        }
        to {
          width: 60px;
        }
      }

      .timeline-item:last-child::after {
        display: none;
      }

      .timeline-dot {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: linear-gradient(135deg, #f7931e, #ff6b35);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 10px;
        font-size: 1.1rem;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(247, 147, 30, 0.4);
      }

      .timeline-item:hover .timeline-dot {
        transform: scale(1.15);
        box-shadow: 0 6px 25px rgba(247, 147, 30, 0.6);
      }

      .timeline-label {
        font-size: 0.8rem;
        color: #888;
      }

      .timeline-value {
        font-size: 1rem;
        color: #fff;
        font-weight: 600;
        margin-top: 4px;
      }

      /* Export Options */
      .export-panel {
        position: fixed;
        bottom: 80px;
        right: 30px;
        background: linear-gradient(145deg, #0d1a26, #152535);
        border: 1px solid rgba(247, 147, 30, 0.3);
        border-radius: 12px;
        padding: 16px;
        z-index: 1001;
        display: none;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.3s ease-out;
      }

      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .export-panel.visible {
        display: block;
      }

      .export-panel h4 {
        color: #f7931e;
        margin-bottom: 12px;
        font-size: 0.9rem;
      }

      .export-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        background: rgba(255, 255, 255, 0.02);
        border: none;
        border-radius: 8px;
        color: #ccc;
        cursor: pointer;
        width: 100%;
        margin-bottom: 8px;
        transition: all 0.3s;
        font-size: 0.85rem;
      }

      .export-option:hover {
        background: rgba(247, 147, 30, 0.15);
        color: #f7931e;
        transform: translateX(5px);
      }

      /* No data */
      .no-data {
        text-align: center;
        padding: 80px;
        color: #666;
        font-size: 1.2rem;
        animation: fadeIn 0.5s ease-out;
      }

      .no-data-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 30px;
        color: #5a6a7a;
        font-size: 0.85rem;
        border-top: 1px solid rgba(247, 147, 30, 0.2);
        margin-top: 40px;
        animation: fadeIn 0.5s ease-out;
      }

      /* Export Button */
      .export-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #f7931e, #ff6b35);
        color: #000;
        border: none;
        padding: 14px 24px;
        border-radius: 30px;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(247, 147, 30, 0.4);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        animation: bounceIn 0.6s ease-out 1s both;
      }

      @keyframes bounceIn {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .export-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 12px 35px rgba(247, 147, 30, 0.5);
      }

      .export-btn:active {
        transform: translateY(-2px) scale(1.02);
      }

      /* Back to Top */
      .back-to-top {
        position: fixed;
        bottom: 30px;
        right: 180px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #fff;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
      }

      .back-to-top.visible {
        display: flex;
        animation: fadeIn 0.3s ease-out;
      }

      .back-to-top:hover {
        background: rgba(247, 147, 30, 0.3);
        border-color: #f7931e;
        transform: translateY(-5px);
      }

      /* Collapsible */
      .collapsible-header {
        cursor: pointer;
        user-select: none;
      }

      .collapsible-header .toggle-icon {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .collapsible-header.collapsed .toggle-icon {
        transform: rotate(-90deg);
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: linear-gradient(
          135deg,
          rgba(76, 175, 80, 0.95),
          rgba(56, 142, 60, 0.95)
        );
        color: #fff;
        padding: 14px 28px;
        border-radius: 12px;
        z-index: 2000;
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        font-weight: 500;
      }

      .toast.visible {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      .toast.error {
        background: linear-gradient(
          135deg,
          rgba(244, 67, 54, 0.95),
          rgba(211, 47, 47, 0.95)
        );
      }

      /* Responsive */
      @media (max-width: 1400px) {
        .quick-nav {
          display: none;
        }
      }

      @media (max-width: 1200px) {
        .summary-row {
          grid-template-columns: repeat(3, 1fr);
        }
        .two-columns,
        .three-columns {
          grid-template-columns: 1fr;
        }
        .risk-details {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .summary-row {
          grid-template-columns: repeat(2, 1fr);
        }
        .header {
          flex-direction: column;
          gap: 16px;
        }
        .header-right {
          text-align: center;
        }
        .search-bar {
          flex-direction: column;
        }
        .search-container {
          min-width: 100%;
        }
        .filter-group {
          justify-content: center;
          width: 100%;
        }
        .risk-score-section {
          flex-direction: column;
        }
        .container {
          padding: 20px;
        }
      }

      @media print {
        .export-btn,
        .back-to-top,
        .quick-nav,
        .export-panel,
        .search-bar,
        .loading-screen {
          display: none !important;
        }
        body {
          background: #fff;
          color: #000;
        }
        .header {
          position: relative;
        }
        .panel,
        .summary-card,
        .risk-score-section {
          break-inside: avoid;
        }
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #f7931e, #ff6b35);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #ffb347, #f7931e);
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes fadeInRight {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }
      .fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
      }
      .fade-in-left {
        animation: fadeInLeft 0.5s ease-out forwards;
      }
      .fade-in-right {
        animation: fadeInRight 0.5s ease-out forwards;
      }
      .scale-in {
        animation: scaleIn 0.4s ease-out forwards;
      }

      .delay-1 {
        animation-delay: 0.1s;
        opacity: 0;
      }
      .delay-2 {
        animation-delay: 0.2s;
        opacity: 0;
      }
      .delay-3 {
        animation-delay: 0.3s;
        opacity: 0;
      }
      .delay-4 {
        animation-delay: 0.4s;
        opacity: 0;
      }
      .delay-5 {
        animation-delay: 0.5s;
        opacity: 0;
      }

      /* Floating particles background */
      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: rgba(247, 147, 30, 0.3);
        border-radius: 50%;
        animation: float 15s infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) rotate(720deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading Report...</div>
    </div>

    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <div class="header">
      <div class="header-left">
        <div class="logo">ðŸ” WebRecon</div>
        <div class="header-divider"></div>
        <div class="header-title">
          <h1>Security Scan Report</h1>
          <span class="target-name" id="targetName">Loading...</span>
        </div>
      </div>
      <div class="header-right">
        <div class="header-meta">
          <div class="header-meta-item">
            <span class="icon">ðŸ“…</span>
            <span id="reportDate">Generated: --</span>
          </div>
          <div class="header-meta-item">
            <span class="icon">ðŸ”‘</span>
            <span class="value" id="scanId">Scan ID: --</span>
          </div>
        </div>
        <div class="header-actions">
          <button class="header-btn" onclick="window.print()">
            <span>ðŸ–¨ï¸ Print</span>
          </button>
          <button class="header-btn" onclick="exportJSON()">
            <span>ðŸ“¥ JSON</span>
          </button>
          <button class="header-btn" onclick="exportCSV()">
            <span>ðŸ“Š CSV</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Quick Navigation - ENHANCED -->
    <nav class="quick-nav" id="quickNav">
      <div class="quick-nav-title">Navigate</div>
      <div class="quick-nav-toggle" onclick="toggleQuickNav()" title="Minimize">
        â€¹
      </div>
      <a href="#summary">
        <span class="nav-icon">ðŸ“Š</span>
        <span class="nav-text">Summary</span>
      </a>
      <a href="#charts" data-tooltip="View Charts">
        <span class="nav-icon">ðŸ“ˆ</span>
        <span class="nav-text">Charts</span>
      </a>
      <a href="#hosts" data-tooltip="Discovered Hosts">
        <span class="nav-icon">ðŸŒ</span>
        <span class="nav-text">Hosts</span>
      </a>
      <a href="#tech" data-tooltip="Technologies">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-text">Tech</span>
      </a>
      <a href="#security" data-tooltip="Security Analysis">
        <span class="nav-icon">ðŸ”’</span>
        <span class="nav-text">Security</span>
      </a>
      <a href="#infrastructure" data-tooltip="Infrastructure">
        <span class="nav-icon">ðŸ—ï¸</span>
        <span class="nav-text">Infra</span>
      </a>
      <a href="#cors" data-tooltip="CORS Configuration">
        <span class="nav-icon">ðŸ”—</span>
        <span class="nav-text">CORS</span>
      </a>
      <a href="#cookies" data-tooltip="Cookies Found">
        <span class="nav-icon">ðŸª</span>
        <span class="nav-text">Cookies</span>
      </a>
      <a href="#headers" data-tooltip="HTTP Headers">
        <span class="nav-icon">ðŸ“‹</span>
        <span class="nav-text">Headers</span>
      </a>
      <a href="#paths" data-tooltip="Discovered Paths">
        <span class="nav-icon">ðŸ“</span>
        <span class="nav-text">Paths</span>
      </a>
      <a href="#nodes" data-tooltip="All Nodes">
        <span class="nav-icon">ðŸ”—</span>
        <span class="nav-text">Nodes</span>
      </a>
      <div class="quick-nav-progress">
        <div class="quick-nav-progress-bar" id="navProgressBar"></div>
      </div>
    </nav>

    <div class="container">
      <!-- Search & Filter - ENHANCED -->
      <div class="search-bar fade-in-up" id="summary">
        <div class="search-container">
          <span class="search-icon">ðŸ”</span>
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="Search hosts, IPs, paths, technologies..."
            autocomplete="off"
          />
          <div class="keyboard-hint">
            <span class="kbd">Ctrl</span>
            <span class="kbd">F</span>
          </div>
          <div class="search-loading" id="searchLoading"></div>
          <span class="search-results-count" id="searchResultsCount"></span>
          <button class="search-clear" id="searchClear" onclick="clearSearch()">
            âœ•
          </button>

          <!-- Search Suggestions Dropdown -->
          <div class="search-suggestions" id="searchSuggestions">
            <div class="search-suggestions-header">
              <span>ðŸ’¡ Suggestions</span>
              <button class="close-btn" onclick="closeSuggestions()">âœ•</button>
            </div>
            <div id="suggestionsContent"></div>
          </div>
        </div>
        <div class="filter-group" id="filterGroup">
          <button
            class="filter-btn active"
            data-filter="all"
            onclick="setFilter('all', this)"
          >
            All <span class="count" id="filterAllCount">0</span>
          </button>
          <button
            class="filter-btn"
            data-filter="host"
            onclick="setFilter('host', this)"
          >
            Hosts <span class="count" id="filterHostCount">0</span>
          </button>
          <button
            class="filter-btn"
            data-filter="ip"
            onclick="setFilter('ip', this)"
          >
            IPs <span class="count" id="filterIpCount">0</span>
          </button>
          <button
            class="filter-btn"
            data-filter="path"
            onclick="setFilter('path', this)"
          >
            Paths <span class="count" id="filterPathCount">0</span>
          </button>
          <button
            class="filter-btn"
            data-filter="200"
            onclick="setFilter('200', this)"
          >
            Active <span class="count" id="filterActiveCount">0</span>
          </button>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="summary-row" id="summaryCards"></div>

      <!-- Risk Score Section -->
      <div class="risk-score-section" id="riskSection">
        <div class="risk-gauge">
          <canvas id="riskGauge" width="200" height="100"></canvas>
          <div class="risk-score-value">
            <div class="score" id="riskScore">--</div>
            <div class="label">Risk Score</div>
          </div>
        </div>
        <div class="risk-details">
          <div class="risk-item risk-critical">
            <div class="count" id="criticalCount">0</div>
            <div class="label">Critical</div>
          </div>
          <div class="risk-item risk-high">
            <div class="count" id="highCount">0</div>
            <div class="label">High</div>
          </div>
          <div class="risk-item risk-medium">
            <div class="count" id="mediumCount">0</div>
            <div class="label">Medium</div>
          </div>
          <div class="risk-item risk-low">
            <div class="count" id="lowCount">0</div>
            <div class="label">Low / Info</div>
          </div>
        </div>
      </div>

      <!-- Scan Timeline -->
      <div class="timeline-section" id="timelineSection">
        <h3 style="color: #f7931e; margin-bottom: 16px; font-size: 1rem">
          ðŸ“… Scan Overview
        </h3>
        <div class="timeline" id="timeline"></div>
      </div>

      <!-- Charts Row -->
      <div class="two-columns" id="charts">
        <div class="fade-in-left delay-1">
          <div class="section-header">
            <span class="left">Node Type Distribution</span>
            <span class="count-badge" id="typeCount">0 types</span>
          </div>
          <div class="panel chart-panel">
            <div class="chart-wrapper">
              <div class="chart-container">
                <canvas id="pieChart" width="280" height="280"></canvas>
              </div>
              <div class="chart-legend" id="chartLegend"></div>
            </div>
          </div>
        </div>
        <div class="fade-in-right delay-2">
          <div class="section-header">
            <span class="left">HTTP Status Distribution</span>
            <span class="count-badge" id="statusCount">0 responses</span>
          </div>
          <div class="panel chart-panel">
            <div class="chart-wrapper">
              <div class="chart-container">
                <canvas id="statusChart" width="280" height="280"></canvas>
              </div>
              <div class="chart-legend" id="statusLegend"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Subdomains & Hosts -->
      <div id="hosts" class="fade-in-up delay-2">
        <div class="section-header">
          <span class="left">Discovered Hosts & Subdomains</span>
          <div class="actions">
            <span class="count-badge" id="hostsCount">0 hosts</span>
            <button class="action-btn" onclick="copyTableData('hostsTable')">
              ðŸ“‹ Copy
            </button>
          </div>
        </div>
        <div class="panel">
          <div class="scrollable-table">
            <table>
              <thead>
                <tr>
                  <th onclick="sortTable('hostsTable', 0)">
                    Hostname <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('hostsTable', 1)">
                    Role <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('hostsTable', 2)">
                    Status <span class="sort-icon">â†•</span>
                  </th>
                  <th>Technologies</th>
                  <th>IP Addresses</th>
                </tr>
              </thead>
              <tbody id="hostsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Technologies & IPs -->
      <div class="two-columns" id="tech">
        <div class="fade-in-left delay-3">
          <div class="section-header">
            <span class="left">Detected Technologies</span>
            <span class="count-badge" id="techCount">0 technologies</span>
          </div>
          <div
            class="panel"
            style="padding: 20px; min-height: 150px"
            id="techPanel"
          ></div>
        </div>
        <div class="fade-in-right delay-3">
          <div class="section-header">
            <span class="left">Resolved IP Addresses</span>
            <span class="count-badge" id="ipCount">0 IPs</span>
          </div>
          <div
            class="panel"
            style="padding: 20px; min-height: 150px"
            id="ipPanel"
          ></div>
        </div>
      </div>

      <!-- Security Headers Analysis -->
      <div id="security" class="fade-in-up delay-3">
        <div class="section-header">
          <span class="left">Security Headers Analysis</span>
          <div class="actions">
            <span class="count-badge security-score" id="securityScore"
              >--</span
            >
          </div>
        </div>
        <div class="panel">
          <div class="scrollable-table">
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>HSTS</th>
                  <th>CSP</th>
                  <th>X-Frame-Options</th>
                  <th>X-Content-Type</th>
                  <th>X-XSS-Protection</th>
                  <th>Score</th>
                </tr>
              </thead>
              <tbody id="securityTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Infrastructure & CDN Detection -->
      <div id="infrastructure" class="fade-in-up delay-3">
        <div class="section-header">
          <span class="left">ðŸ—ï¸ Infrastructure & CDN Detection</span>
          <span class="count-badge" id="infraCount">0 detected</span>
        </div>
        <div class="panel">
          <div class="scrollable-table">
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Server</th>
                  <th>CDN / Proxy</th>
                  <th>CF-RAY</th>
                  <th>Envoy Info</th>
                  <th>Via</th>
                </tr>
              </thead>
              <tbody id="infraTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- HSTS Details & HTTP/3 -->
      <div class="two-columns">
        <div id="hstsDetails" class="fade-in-left delay-3">
          <div class="section-header">
            <span class="left">ðŸ”’ HSTS Configuration</span>
            <span class="count-badge" id="hstsCount">0 hosts</span>
          </div>
          <div
            class="panel"
            style="padding: 0; max-height: 350px; overflow-y: auto"
          >
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Max-Age</th>
                  <th>Include Subdomains</th>
                  <th>Preload</th>
                </tr>
              </thead>
              <tbody id="hstsTable"></tbody>
            </table>
          </div>
        </div>

        <div id="http3Details" class="fade-in-right delay-3">
          <div class="section-header">
            <span class="left">âš¡ HTTP/3 & Alt-Svc Support</span>
            <span class="count-badge" id="altSvcCount">0 hosts</span>
          </div>
          <div
            class="panel"
            style="padding: 0; max-height: 350px; overflow-y: auto"
          >
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Protocol</th>
                  <th>Alt-Svc Value</th>
                </tr>
              </thead>
              <tbody id="altSvcTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- CORS Analysis -->
      <div id="cors" class="fade-in-up delay-4">
        <div class="section-header">
          <span class="left">ðŸŒ CORS Configuration</span>
          <span class="count-badge" id="corsCount">0 hosts</span>
        </div>
        <div class="panel">
          <div class="scrollable-table" style="max-height: 350px">
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Allow-Origin</th>
                  <th>Allow-Methods</th>
                  <th>Allow-Headers</th>
                  <th>Allow-Credentials</th>
                  <th>Expose-Headers</th>
                  <th>Max-Age</th>
                </tr>
              </thead>
              <tbody id="corsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Cache & Client Hints -->
      <div class="two-columns">
        <div id="cacheDetails" class="fade-in-left delay-4">
          <div class="section-header">
            <span class="left">ðŸ’¾ Cache Control</span>
            <span class="count-badge" id="cacheCount">0 hosts</span>
          </div>
          <div
            class="panel"
            style="padding: 0; max-height: 350px; overflow-y: auto"
          >
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Cache-Control</th>
                  <th>ETag</th>
                  <th>Last-Modified</th>
                </tr>
              </thead>
              <tbody id="cacheTable"></tbody>
            </table>
          </div>
        </div>

        <div id="clientHints" class="fade-in-right delay-4">
          <div class="section-header">
            <span class="left">ðŸ“± Client Hints & Permissions</span>
            <span class="count-badge" id="hintsCount">0 hosts</span>
          </div>
          <div
            class="panel"
            style="padding: 0; max-height: 350px; overflow-y: auto"
          >
            <table>
              <thead>
                <tr>
                  <th>Host</th>
                  <th>Accept-CH</th>
                  <th>Permissions-Policy</th>
                </tr>
              </thead>
              <tbody id="hintsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Cookies Found -->
      <div id="cookies" class="fade-in-up delay-4">
        <div class="section-header">
          <span class="left">Cookies Detected</span>
          <span class="count-badge" id="cookieCount">0 cookies</span>
        </div>
        <div
          class="panel"
          id="cookiesPanel"
          style="max-height: 400px; overflow-y: auto"
        ></div>
      </div>

      <!-- HTTP Headers -->
      <div id="headers" class="fade-in-up delay-4">
        <div
          class="section-header collapsible-header"
          onclick="toggleSection('headersPanel', this)"
        >
          <span class="left">Full HTTP Headers</span>
          <span class="toggle-icon">â–¼</span>
        </div>
        <div
          class="panel"
          id="headersPanel"
          style="max-height: 500px; overflow-y: auto"
        ></div>
      </div>

      <!-- Directory Structure -->
      <div id="paths" class="fade-in-up delay-4">
        <div class="section-header">
          <span class="left">Discovered Paths & Endpoints</span>
          <div class="actions">
            <span class="count-badge" id="pathCount">0 paths</span>
            <button class="action-btn" onclick="copyTableData('pathsTable')">
              ðŸ“‹ Copy
            </button>
          </div>
        </div>
        <div class="panel">
          <div class="scrollable-table" style="max-height: 500px">
            <table>
              <thead>
                <tr>
                  <th onclick="sortTable('pathsTable', 0)">
                    Path <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('pathsTable', 1)">
                    Type <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('pathsTable', 2)">
                    Hostname <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('pathsTable', 3)">
                    Level <span class="sort-icon">â†•</span>
                  </th>
                </tr>
              </thead>
              <tbody id="pathsTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- All Nodes -->
      <div id="nodes" class="fade-in-up delay-5">
        <div class="section-header">
          <span class="left">Complete Node Inventory</span>
          <div class="actions">
            <span class="count-badge" id="nodesCount">0 nodes</span>
            <button class="action-btn" onclick="copyTableData('allNodesTable')">
              ðŸ“‹ Copy
            </button>
            <button class="action-btn" onclick="exportJSON()">ðŸ“¥ Export</button>
          </div>
        </div>
        <div class="panel">
          <div class="scrollable-table" style="max-height: 600px">
            <table>
              <thead>
                <tr>
                  <th onclick="sortTable('allNodesTable', 0)">
                    Type <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('allNodesTable', 1)">
                    Label <span class="sort-icon">â†•</span>
                  </th>
                  <th>Full Path</th>
                  <th onclick="sortTable('allNodesTable', 3)">
                    Level <span class="sort-icon">â†•</span>
                  </th>
                  <th onclick="sortTable('allNodesTable', 4)">
                    Status <span class="sort-icon">â†•</span>
                  </th>
                </tr>
              </thead>
              <tbody id="allNodesTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="no-data" id="noData" style="display: none">
        <div class="no-data-icon">ðŸ“­</div>
        <div>No report data found.</div>
        <div style="font-size: 0.9rem; margin-top: 10px; color: #888">
          Please generate a report from the application.
        </div>
      </div>
    </div>

    <div class="footer">
      <div>Generated by WebRecon Scanner â€¢ Confidential Security Report</div>
      <div id="footerDate" style="margin-top: 8px"></div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
      â†‘
    </button>

    <!-- Export Button -->
    <button class="export-btn" onclick="toggleExportPanel()">ðŸ“¤ Export</button>

    <!-- Export Panel -->
    <div class="export-panel" id="exportPanel">
      <h4>Export Options</h4>
      <button class="export-option" onclick="window.print()">
        ðŸ–¨ï¸ Print / Save as PDF
      </button>
      <button class="export-option" onclick="exportJSON()">
        ðŸ“¥ Download JSON
      </button>
      <button class="export-option" onclick="exportCSV()">
        ðŸ“Š Download CSV
      </button>
      <button class="export-option" onclick="copyReportLink()">
        ðŸ”— Copy Report Link
      </button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
      // Global state
      let reportData = null;
      let currentFilter = "all";
      let searchQuery = "";
      let allNodes = [];
      let debounceTimer = null;
      let recentSearches = [];
      let selectedSuggestionIndex = -1;
      let currentSuggestions = [];
      const MAX_RECENT_SEARCHES = 5;

      const NODE_COLORS = {
        host: "#00d4ff",
        subdomain: "#00e5cc",
        ip: "#ff9f43",
        endpoint: "#26de81",
        url: "#2bcbba",
        path: "#20bf6b",
        dir: "#26de81",
        file: "#badc58",
        api: "#fd79a8",
        finding: "#fc5c65",
        vulnerability: "#eb3b5a",
        technology: "#a55eea",
        tech: "#8854d0",
        header: "#5f27cd",
        cookie: "#d35400",
        parameter: "#576574",
        default: "#a0a0a0",
      };

      const STATUS_COLORS = {
        200: "#4caf50",
        301: "#2196f3",
        302: "#2196f3",
        400: "#ff9800",
        403: "#f44336",
        404: "#f44336",
        500: "#9c27b0",
        null: "#9e9e9e",
      };

      // Create floating particles
      function createParticles() {
        const container = document.getElementById("particles");
        for (let i = 0; i < 20; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 15 + "s";
          particle.style.animationDuration = 15 + Math.random() * 10 + "s";
          container.appendChild(particle);
        }
      }

      // Animated counter
      function animateCounter(element, target, duration = 1000) {
        const start = 0;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);
          const current = Math.floor(start + (target - start) * easeOut);
          element.textContent = current.toLocaleString();

          if (progress < 1) {
            requestAnimationFrame(update);
          }
        }

        requestAnimationFrame(update);
      }

      function getNodeColor(type) {
        return (
          NODE_COLORS[String(type || "").toLowerCase()] || NODE_COLORS.default
        );
      }

      function getStatusColor(status) {
        return STATUS_COLORS[status] || STATUS_COLORS.null;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = String(text || "");
        return div.innerHTML;
      }

      function showToast(message, isError = false) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = isError ? "toast visible error" : "toast visible";
        setTimeout(() => toast.classList.remove("visible"), 3000);
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("âœ“ Copied to clipboard!");
          })
          .catch(() => {
            showToast("Failed to copy", true);
          });
      }

      function copyTableData(tableId) {
        const table = document.getElementById(tableId);
        const rows = Array.from(table.querySelectorAll("tr:not(.hidden-row)"));
        const text = rows
          .map((row) =>
            Array.from(row.querySelectorAll("td"))
              .map((td) => td.textContent.trim())
              .join("\t"),
          )
          .join("\n");
        copyToClipboard(text);
      }

      function toggleExportPanel() {
        document.getElementById("exportPanel").classList.toggle("visible");
      }

      function exportJSON() {
        if (!reportData) return;
        const blob = new Blob([JSON.stringify(reportData, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `scan-report-${reportData.target || "unknown"}-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showToast("âœ“ JSON exported successfully!");
        toggleExportPanel();
      }

      function exportCSV() {
        if (!reportData) return;
        const nodes = reportData.graph?.nodes || [];
        const headers = [
          "Type",
          "Label",
          "Hostname",
          "Path",
          "Status",
          "Level",
        ];
        const rows = nodes.map((n) => [
          n.type,
          n.label,
          n.hostname || "",
          n.path || "",
          n.status || "",
          n.level || "",
        ]);
        const csv = [headers, ...rows]
          .map((row) =>
            row
              .map((cell) => `"${String(cell).replace(/"/g, '""')}"`)
              .join(","),
          )
          .join("\n");
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `scan-report-${reportData.target || "unknown"}-${Date.now()}.csv`;
        a.click();
        URL.revokeObjectURL(url);
        showToast("âœ“ CSV exported successfully!");
        toggleExportPanel();
      }

      function copyReportLink() {
        copyToClipboard(window.location.href);
        toggleExportPanel();
      }

      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // FIXED: Smooth scroll to section with offset for sticky header
      function scrollToSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
          const headerHeight = document.querySelector(".header").offsetHeight;
          const offsetTop =
            section.getBoundingClientRect().top +
            window.pageYOffset -
            headerHeight -
            20;

          window.scrollTo({
            top: offsetTop,
            behavior: "smooth",
          });
        }
      }

      // FIXED: Navigation scroll handling
      function initNavigation() {
        // Handle quick nav clicks
        document.querySelectorAll(".quick-nav a").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            const targetId = link.getAttribute("href").substring(1);
            scrollToSection(targetId);

            // Update active state
            document
              .querySelectorAll(".quick-nav a")
              .forEach((a) => a.classList.remove("active"));
            link.classList.add("active");
          });
        });

        // Update active nav on scroll and progress bar
        window.addEventListener("scroll", () => {
          const sections = [
            "summary",
            "charts",
            "hosts",
            "tech",
            "security",
            "infrastructure",
            "cors",
            "cookies",
            "headers",
            "paths",
            "nodes",
          ];
          const headerHeight =
            document.querySelector(".header")?.offsetHeight || 100;

          let currentSection = "";
          sections.forEach((id) => {
            const section = document.getElementById(id);
            if (section) {
              const rect = section.getBoundingClientRect();
              if (rect.top <= headerHeight + 50 && rect.bottom > headerHeight) {
                currentSection = id;
              }
            }
          });

          document.querySelectorAll(".quick-nav a").forEach((link) => {
            const href = link.getAttribute("href").substring(1);
            link.classList.toggle("active", href === currentSection);
          });

          // Update progress bar
          const scrollHeight =
            document.documentElement.scrollHeight - window.innerHeight;
          const scrollProgress = (window.scrollY / scrollHeight) * 100;
          const progressBar = document.getElementById("navProgressBar");
          if (progressBar) {
            progressBar.style.width = `${Math.min(scrollProgress, 100)}%`;
          }

          // Back to top button visibility
          const backToTop = document.getElementById("backToTop");
          backToTop.classList.toggle("visible", window.scrollY > 500);
        });
      }

      function toggleQuickNav() {
        const nav = document.getElementById("quickNav");
        const toggle = nav.querySelector(".quick-nav-toggle");
        nav.classList.toggle("minimized");
        toggle.textContent = nav.classList.contains("minimized") ? "â€º" : "â€¹";
      }

      // Update active nav on scroll

      // ENHANCED: Search functionality with suggestions
      function initSearch() {
        const searchInput = document.getElementById("searchInput");
        const searchClear = document.getElementById("searchClear");

        // Load recent searches from localStorage
        try {
          recentSearches = JSON.parse(
            localStorage.getItem("recentSearches") || "[]",
          );
        } catch (e) {
          recentSearches = [];
        }

        searchInput.addEventListener("input", (e) => {
          const query = e.target.value;
          searchClear.classList.toggle("visible", query.length > 0);
          document
            .querySelector(".keyboard-hint")
            ?.classList.toggle("hidden", query.length > 0);

          // Show loading
          document.getElementById("searchLoading").classList.add("visible");

          // Debounce search
          clearTimeout(debounceTimer);
          debounceTimer = setTimeout(() => {
            document
              .getElementById("searchLoading")
              .classList.remove("visible");
            handleSearch(query);
            if (query.length > 0) {
              showSuggestions(query);
            } else {
              showRecentSearches();
            }
          }, 200);
        });

        searchInput.addEventListener("focus", () => {
          if (searchInput.value.length === 0) {
            showRecentSearches();
          } else {
            showSuggestions(searchInput.value);
          }
        });

        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            clearSearch();
            closeSuggestions();
          } else if (e.key === "ArrowDown") {
            e.preventDefault();
            navigateSuggestions(1);
          } else if (e.key === "ArrowUp") {
            e.preventDefault();
            navigateSuggestions(-1);
          } else if (e.key === "Enter") {
            e.preventDefault();
            if (
              selectedSuggestionIndex >= 0 &&
              currentSuggestions[selectedSuggestionIndex]
            ) {
              selectSuggestion(currentSuggestions[selectedSuggestionIndex]);
            } else {
              closeSuggestions();
              saveRecentSearch(searchInput.value);
            }
          }
        });

        // Close suggestions when clicking outside
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".search-container")) {
            closeSuggestions();
          }
        });
      }

      function showSuggestions(query) {
        if (!allNodes.length || query.length < 1) {
          closeSuggestions();
          return;
        }

        const lowerQuery = query.toLowerCase();
        const suggestions = [];
        const seen = new Set();

        // Search through nodes
        allNodes.forEach((node) => {
          const searchableText = [
            node.label,
            node.hostname,
            node.path,
            node.type,
            ...(node.technologies || []),
          ]
            .filter(Boolean)
            .join(" ")
            .toLowerCase();

          if (searchableText.includes(lowerQuery) && !seen.has(node.label)) {
            seen.add(node.label);
            suggestions.push({
              type: node.type,
              label: node.label,
              hostname: node.hostname,
              path: node.path,
              status: node.status,
              icon: getNodeIcon(node.type),
            });
          }
        });

        // Limit suggestions
        currentSuggestions = suggestions.slice(0, 10);
        selectedSuggestionIndex = -1;

        renderSuggestions(query, currentSuggestions);
      }

      function getNodeIcon(type) {
        const icons = {
          host: "ðŸŒ",
          subdomain: "ðŸ”—",
          ip: "ðŸ“",
          endpoint: "ðŸŽ¯",
          path: "ðŸ“",
          dir: "ðŸ“‚",
          file: "ðŸ“„",
          technology: "âš™ï¸",
          tech: "âš™ï¸",
          cookie: "ðŸª",
          header: "ðŸ“‹",
        };
        return icons[type] || "ðŸ“¦";
      }

      function renderSuggestions(query, suggestions) {
        const container = document.getElementById("suggestionsContent");
        const suggestionsEl = document.getElementById("searchSuggestions");

        if (suggestions.length === 0) {
          container.innerHTML = `
            <div class="no-suggestions">
              <div class="no-suggestions-icon">ðŸ”Ž</div>
              <div>No matches found for "<strong>${escapeHtml(query)}</strong>"</div>
              <div style="font-size: 0.8rem; margin-top: 8px; color: #666;">Try searching for hosts, IPs, or technologies</div>
            </div>
          `;
        } else {
          // Group by type
          const grouped = {};
          suggestions.forEach((s) => {
            if (!grouped[s.type]) grouped[s.type] = [];
            grouped[s.type].push(s);
          });

          let html = "";
          Object.entries(grouped).forEach(([type, items]) => {
            html += `<div class="suggestion-category">${type.toUpperCase()}S (${items.length})</div>`;
            items.forEach((item) => {
              const globalIndex = currentSuggestions.indexOf(item);
              const highlightedLabel = highlightMatch(item.label, query);
              html += `
                <div class="suggestion-item ${globalIndex === selectedSuggestionIndex ? "selected" : ""}"
                     style="--suggestion-color: ${getNodeColor(item.type)}"
                     data-index="${globalIndex}"
                     onclick="selectSuggestion(currentSuggestions[${globalIndex}])">
                  <div class="suggestion-icon">${item.icon}</div>
                  <div class="suggestion-content">
                    <div class="suggestion-title">${highlightedLabel}</div>
                    <div class="suggestion-meta">
                      <span class="suggestion-type" style="color: ${getNodeColor(item.type)}">${item.type}</span>
                      ${item.hostname ? `<span>ðŸ“¡ ${escapeHtml(item.hostname)}</span>` : ""}
                      ${item.status ? `<span style="color: ${getStatusColor(item.status)}">â— ${item.status}</span>` : ""}
                    </div>
                  </div>
                </div>
              `;
            });
          });

          container.innerHTML = html;
        }

        suggestionsEl.classList.add("visible");
      }

      function highlightMatch(text, query) {
        if (!text || !query) return escapeHtml(text || "");
        const escaped = escapeHtml(text);
        const regex = new RegExp(`(${escapeHtml(query)})`, "gi");
        return escaped.replace(regex, '<span class="highlight">$1</span>');
      }

      function showRecentSearches() {
        const container = document.getElementById("suggestionsContent");
        const suggestionsEl = document.getElementById("searchSuggestions");

        if (recentSearches.length === 0) {
          container.innerHTML = `
            <div class="no-suggestions">
              <div class="no-suggestions-icon">ðŸ’¡</div>
              <div>Start typing to search</div>
              <div style="font-size: 0.8rem; margin-top: 8px; color: #666;">Search for hosts, IPs, paths, or technologies</div>
            </div>
          `;
        } else {
          container.innerHTML = `
            <div class="suggestion-category">Recent Searches</div>
            <div class="recent-searches">
              ${recentSearches
                .map(
                  (search, i) => `
                <div class="recent-search-item" onclick="applyRecentSearch('${escapeHtml(search)}')">
                  ðŸ• ${escapeHtml(search)}
                  <span class="remove" onclick="event.stopPropagation(); removeRecentSearch(${i})">âœ•</span>
                </div>
              `,
                )
                .join("")}
            </div>
          `;
        }

        suggestionsEl.classList.add("visible");
      }

      function navigateSuggestions(direction) {
        if (currentSuggestions.length === 0) return;

        selectedSuggestionIndex += direction;
        if (selectedSuggestionIndex < 0)
          selectedSuggestionIndex = currentSuggestions.length - 1;
        if (selectedSuggestionIndex >= currentSuggestions.length)
          selectedSuggestionIndex = 0;

        // Update visual selection
        document.querySelectorAll(".suggestion-item").forEach((el) => {
          el.classList.toggle(
            "selected",
            parseInt(el.dataset.index) === selectedSuggestionIndex,
          );
        });

        // Scroll into view
        const selected = document.querySelector(".suggestion-item.selected");
        if (selected) {
          selected.scrollIntoView({ block: "nearest", behavior: "smooth" });
        }
      }

      function selectSuggestion(suggestion) {
        if (!suggestion) return;

        const searchInput = document.getElementById("searchInput");
        searchInput.value = suggestion.label;
        handleSearch(suggestion.label);
        saveRecentSearch(suggestion.label);
        closeSuggestions();

        // Scroll to relevant section based on type
        const sectionMap = {
          host: "hosts",
          subdomain: "hosts",
          ip: "tech",
          path: "paths",
          dir: "paths",
          file: "paths",
          endpoint: "paths",
        };
        const section = sectionMap[suggestion.type] || "nodes";
        scrollToSection(section);
      }

      function applyRecentSearch(search) {
        const searchInput = document.getElementById("searchInput");
        searchInput.value = search;
        handleSearch(search);
        closeSuggestions();
      }

      function saveRecentSearch(query) {
        if (!query || query.length < 2) return;

        recentSearches = recentSearches.filter((s) => s !== query);
        recentSearches.unshift(query);
        recentSearches = recentSearches.slice(0, MAX_RECENT_SEARCHES);

        try {
          localStorage.setItem(
            "recentSearches",
            JSON.stringify(recentSearches),
          );
        } catch (e) {}
      }

      function removeRecentSearch(index) {
        recentSearches.splice(index, 1);
        try {
          localStorage.setItem(
            "recentSearches",
            JSON.stringify(recentSearches),
          );
        } catch (e) {}
        showRecentSearches();
      }

      function closeSuggestions() {
        document
          .getElementById("searchSuggestions")
          .classList.remove("visible");
        selectedSuggestionIndex = -1;
      }

      function clearSearch() {
        const searchInput = document.getElementById("searchInput");
        searchInput.value = "";
        document.getElementById("searchClear").classList.remove("visible");
        document
          .getElementById("searchResultsCount")
          .classList.remove("visible");
        searchQuery = "";
        applyFilters();
        closeSuggestions();
        searchInput.focus();
      }

      function handleSearch(query) {
        searchQuery = query.toLowerCase().trim();
        applyFilters();
      }

      function setFilter(filter, btn) {
        currentFilter = filter;
        document
          .querySelectorAll(".filter-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        applyFilters();
      }

      function applyFilters() {
        if (!reportData || !allNodes.length) return;

        let matchCount = 0;

        // Filter all table rows
        const allTables = ["hostsTable", "pathsTable", "allNodesTable"];

        allTables.forEach((tableId) => {
          const tbody = document.getElementById(tableId);
          if (!tbody) return;

          const rows = tbody.querySelectorAll("tr");
          rows.forEach((row) => {
            const text = row.textContent.toLowerCase();
            const rowType = row.dataset.type || "";
            const rowStatus = row.dataset.status || "";

            let matchesFilter = true;
            let matchesSearch = true;

            // Apply type/status filter
            if (currentFilter !== "all") {
              if (currentFilter === "200") {
                matchesFilter = rowStatus === "200";
              } else {
                matchesFilter = rowType === currentFilter;
              }
            }

            // Apply search filter
            if (searchQuery) {
              matchesSearch = text.includes(searchQuery);
            }

            const isVisible = matchesFilter && matchesSearch;
            row.classList.toggle("hidden-row", !isVisible);
            row.classList.toggle(
              "highlighted",
              searchQuery && matchesSearch && isVisible,
            );

            if (isVisible && searchQuery) matchCount++;
          });
        });

        // Update search results count
        const resultsCount = document.getElementById("searchResultsCount");
        if (searchQuery) {
          resultsCount.textContent = `${matchCount} results`;
          resultsCount.classList.add("visible");
        } else {
          resultsCount.classList.remove("visible");
        }
      }

      function updateFilterCounts(nodes) {
        const hosts = nodes.filter((n) => n.type === "host").length;
        const ips = nodes.filter((n) => n.type === "ip").length;
        const paths = nodes.filter((n) =>
          ["path", "dir", "file", "endpoint"].includes(n.type),
        ).length;
        const active = nodes.filter((n) => n.status === 200).length;

        document.getElementById("filterAllCount").textContent = nodes.length;
        document.getElementById("filterHostCount").textContent = hosts;
        document.getElementById("filterIpCount").textContent = ips;
        document.getElementById("filterPathCount").textContent = paths;
        document.getElementById("filterActiveCount").textContent = active;
      }

      // Table Sorting
      let sortState = {};
      function sortTable(tableId, colIndex) {
        const tbody = document.getElementById(tableId);
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const key = `${tableId}-${colIndex}`;
        sortState[key] = !sortState[key];

        rows.sort((a, b) => {
          const aVal = a.cells[colIndex]?.textContent.trim() || "";
          const bVal = b.cells[colIndex]?.textContent.trim() || "";
          const aNum = parseFloat(aVal);
          const bNum = parseFloat(bVal);

          if (!isNaN(aNum) && !isNaN(bNum)) {
            return sortState[key] ? aNum - bNum : bNum - aNum;
          }
          return sortState[key]
            ? aVal.localeCompare(bVal)
            : bVal.localeCompare(aVal);
        });

        rows.forEach((row, i) => {
          row.style.animationDelay = `${i * 0.02}s`;
          tbody.appendChild(row);
        });
      }

      function countByProperty(nodes, prop) {
        const counts = {};
        nodes.forEach((n) => {
          const val = String(n[prop] ?? "unknown").toLowerCase();
          counts[val] = (counts[val] || 0) + 1;
        });
        return Object.entries(counts).sort((a, b) => b[1] - a[1]);
      }

      function drawDonutChart(canvas, data, colorFn) {
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = Math.min(centerX, centerY) - 15;
        const total = data.reduce((sum, [, count]) => sum + count, 0);

        if (total === 0) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        let startAngle = -Math.PI / 2;
        data.slice(0, 10).forEach(([label, count], index) => {
          const sliceAngle = (count / total) * 2 * Math.PI;

          // Animate slice
          setTimeout(() => {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(
              centerX,
              centerY,
              radius,
              startAngle,
              startAngle + sliceAngle,
            );
            ctx.closePath();
            ctx.fillStyle = colorFn(label);
            ctx.fill();
            ctx.strokeStyle = "#0d1a26";
            ctx.lineWidth = 2;
            ctx.stroke();
          }, index * 100);

          startAngle += sliceAngle;
        });

        // Center hole (delayed)
        setTimeout(
          () => {
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.55, 0, 2 * Math.PI);
            ctx.fillStyle = "#0d1a26";
            ctx.fill();

            ctx.fillStyle = "#fff";
            ctx.font = "bold 32px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(total.toString(), centerX, centerY - 8);
            ctx.font = "11px sans-serif";
            ctx.fillStyle = "#888";
            ctx.fillText("TOTAL", centerX, centerY + 16);
          },
          data.length * 100 + 100,
        );
      }

      function drawRiskGauge(score) {
        const canvas = document.getElementById("riskGauge");
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height - 10;
        const radius = 80;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Background arc
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, Math.PI, 0);
        ctx.lineWidth = 20;
        ctx.strokeStyle = "rgba(255, 255, 255, 0.1)";
        ctx.stroke();

        // Animated score arc
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
        gradient.addColorStop(0, "#4caf50");
        gradient.addColorStop(0.5, "#ffc107");
        gradient.addColorStop(1, "#f44336");

        let currentScore = 0;
        const animateGauge = () => {
          if (currentScore < score) {
            currentScore += 2;
            if (currentScore > score) currentScore = score;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Background
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, Math.PI, 0);
            ctx.lineWidth = 20;
            ctx.strokeStyle = "rgba(255, 255, 255, 0.1)";
            ctx.stroke();

            // Score arc
            const scoreAngle = Math.PI + (currentScore / 100) * Math.PI;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, Math.PI, scoreAngle);
            ctx.lineWidth = 20;
            ctx.lineCap = "round";
            ctx.strokeStyle = gradient;
            ctx.stroke();

            requestAnimationFrame(animateGauge);
          }
        };

        setTimeout(animateGauge, 500);

        document.getElementById("riskScore").textContent = score;
        document.getElementById("riskScore").style.color =
          score < 30 ? "#4caf50" : score < 60 ? "#ffc107" : "#f44336";
      }

      function createLegend(container, data, colorFn) {
        container.innerHTML = "";
        const total = data.reduce((sum, [, count]) => sum + count, 0);
        data.slice(0, 10).forEach(([label, count], index) => {
          const percent = ((count / total) * 100).toFixed(1);
          const item = document.createElement("div");
          item.className = "legend-item";
          item.style.setProperty("--legend-color", colorFn(label));
          item.style.animationDelay = `${index * 0.1}s`;
          item.innerHTML = `
            <div class="legend-color" style="background: ${colorFn(label)}"></div>
            <span class="legend-label">${label}</span>
            <span class="legend-count">${count}</span>
            <span class="legend-percent">(${percent}%)</span>
          `;
          item.onclick = () => {
            const filterBtn = document.querySelector(
              `[data-filter="${label}"]`,
            );
            if (filterBtn) {
              setFilter(label, filterBtn);
            }
          };
          container.appendChild(item);
        });
      }

      function toggleSection(panelId, header) {
        const panel = document.getElementById(panelId);
        header.classList.toggle("collapsed");
        panel.style.display = header.classList.contains("collapsed")
          ? "none"
          : "block";
      }

      function populateSummaryCards(nodes, links) {
        const hosts = nodes.filter((n) => n.type === "host").length;

        // Count IPs properly
        const ipSet = new Set();
        nodes.forEach((n) => {
          if (n.ips && Array.isArray(n.ips)) {
            n.ips.forEach((ip) => ipSet.add(ip));
          }
          if (n.type === "ip" && n.label) {
            ipSet.add(n.label);
          }
          if (n.ip) {
            ipSet.add(n.ip);
          }
          if (n.address) {
            ipSet.add(n.address);
          }
        });
        const ips = ipSet.size;

        const paths = nodes.filter((n) =>
          ["path", "dir", "file", "endpoint", "url"].includes(n.type),
        ).length;
        const techs = new Set(nodes.flatMap((n) => n.technologies || [])).size;

        // Count cookies from set-cookie headers too
        let cookieCount = 0;
        nodes.forEach((n) => {
          if (n.cookies && Array.isArray(n.cookies)) {
            cookieCount += n.cookies.length;
          }
          if (n.headers && Array.isArray(n.headers)) {
            n.headers.forEach((hdr) => {
              if (
                hdr.key &&
                hdr.key.toLowerCase() === "set-cookie" &&
                hdr.value
              ) {
                // Count cookies in set-cookie header
                const cookieStrings = hdr.value.split(/,(?=\s*[^;]+=[^;]+)/);
                cookieCount += cookieStrings.length;
              }
            });
          }
          if (n.type === "cookie") {
            cookieCount++;
          }
        });

        const active = nodes.filter((n) => n.status === 200).length;

        const cards = [
          {
            icon: "ðŸŒ",
            value: hosts,
            label: "Hosts",
            color: "#00d4ff",
            percent: 100,
          },
          {
            icon: "ðŸ“",
            value: ips,
            label: "IP Addresses",
            color: "#ff9f43",
            percent: (ips / (nodes.length || 1)) * 100,
          },
          {
            icon: "ðŸ“",
            value: paths,
            label: "Paths Found",
            color: "#20bf6b",
            percent: (paths / (nodes.length || 1)) * 100,
          },
          {
            icon: "âš™ï¸",
            value: techs,
            label: "Technologies",
            color: "#a55eea",
            percent: 100,
          },
          {
            icon: "ðŸª",
            value: cookieCount,
            label: "Cookies",
            color: "#d35400",
            percent: 100,
          },
          {
            icon: "âœ…",
            value: active,
            label: "Active (200)",
            color: "#4caf50",
            percent: (active / (nodes.length || 1)) * 100,
          },
        ];

        const container = document.getElementById("summaryCards");
        container.innerHTML = cards
          .map(
            (card, i) => `
          <div class="summary-card fade-in-up delay-${i + 1}" style="--card-color: ${card.color}">
            <span class="icon">${card.icon}</span>
            <div class="summary-value counter" data-target="${card.value}">0</div>
            <div class="summary-label">${card.label}</div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 0%; background: ${card.color};" data-width="${Math.min(card.percent, 100)}%"></div>
            </div>
          </div>
        `,
          )
          .join("");

        // Animate counters and progress bars
        setTimeout(() => {
          document.querySelectorAll(".counter").forEach((el) => {
            animateCounter(el, parseInt(el.dataset.target));
          });
          document.querySelectorAll(".progress-fill").forEach((el) => {
            el.style.width = el.dataset.width;
          });
        }, 300);
      }

      function populateTimeline(data) {
        const timeline = document.getElementById("timeline");
        const items = [
          { icon: "ðŸŽ¯", label: "Target", value: data.target || "Unknown" },
          {
            icon: "ðŸ“…",
            label: "Date",
            value: new Date(data.timestamp || Date.now()).toLocaleDateString(),
          },
          { icon: "â±ï¸", label: "Duration", value: data.duration || "N/A" },
          {
            icon: "ðŸ”",
            label: "Scan Type",
            value: data.scanType || "Full Scan",
          },
          {
            icon: "ðŸ“Š",
            label: "Nodes Found",
            value: data.graph?.nodes?.length || 0,
          },
        ];

        timeline.innerHTML = items
          .map(
            (item) => `
          <div class="timeline-item">
            <div class="timeline-dot">${item.icon}</div>
            <div class="timeline-label">${item.label}</div>
            <div class="timeline-value">${item.value}</div>
          </div>
        `,
          )
          .join("");
      }

      function calculateRiskScore(nodes) {
        let critical = 0,
          high = 0,
          medium = 0,
          low = 0;

        const hostsWithHeaders = nodes.filter(
          (n) => n.type === "host" && n.headers && n.headers.length > 0,
        );

        // If no hosts with headers, show 0 risk
        if (hostsWithHeaders.length === 0) {
          document.getElementById("criticalCount").textContent = 0;
          document.getElementById("highCount").textContent = 0;
          document.getElementById("mediumCount").textContent = 0;
          document.getElementById("lowCount").textContent = 0;
          drawRiskGauge(0);
          return { critical: 0, high: 0, medium: 0, low: 0, score: 0 };
        }

        hostsWithHeaders.forEach((n) => {
          const headers = {};
          (n.headers || []).forEach((h) => {
            if (h.key) headers[h.key.toLowerCase()] = h.value;
          });

          // Missing security headers
          if (!headers["strict-transport-security"]) high++;
          if (!headers["content-security-policy"]) medium++;
          if (!headers["x-frame-options"]) medium++;
          if (!headers["x-content-type-options"]) low++;

          // Cookies without secure flags
          (n.cookies || []).forEach((c) => {
            if (!c.secure) high++;
            if (!c.httpOnly) medium++;
          });
        });

        document.getElementById("criticalCount").textContent = critical;
        document.getElementById("highCount").textContent = high;
        document.getElementById("mediumCount").textContent = medium;
        document.getElementById("lowCount").textContent = low;

        // Calculate score - if no issues found, score is 0 (good)
        const totalIssues = critical + high + medium + low;
        const score =
          totalIssues === 0
            ? 0
            : Math.min(100, critical * 25 + high * 10 + medium * 5 + low * 2);

        drawRiskGauge(score);

        return { critical, high, medium, low, score };
      }

      function populateHostsTable(nodes, links) {
        const tbody = document.getElementById("hostsTable");
        const hosts = nodes.filter(
          (n) => n.type === "host" || n.type === "subdomain",
        );

        // Build a map of host -> IPs from links and IP nodes
        const hostIpMap = {};

        // First, find all IP nodes
        const ipNodes = nodes.filter((n) => n.type === "ip");

        // Build link map: find which hosts connect to which IPs
        links.forEach((link) => {
          const sourceNode = nodes.find(
            (n) => n.id === link.source || n.label === link.source,
          );
          const targetNode = nodes.find(
            (n) => n.id === link.target || n.label === link.target,
          );

          if (sourceNode && targetNode) {
            // If source is host and target is IP
            if (
              (sourceNode.type === "host" || sourceNode.type === "subdomain") &&
              targetNode.type === "ip"
            ) {
              const hostKey = sourceNode.hostname || sourceNode.label;
              if (!hostIpMap[hostKey]) hostIpMap[hostKey] = new Set();
              hostIpMap[hostKey].add(
                targetNode.label || targetNode.ip || targetNode.address,
              );
            }
            // If target is host and source is IP
            if (
              (targetNode.type === "host" || targetNode.type === "subdomain") &&
              sourceNode.type === "ip"
            ) {
              const hostKey = targetNode.hostname || targetNode.label;
              if (!hostIpMap[hostKey]) hostIpMap[hostKey] = new Set();
              hostIpMap[hostKey].add(
                sourceNode.label || sourceNode.ip || sourceNode.address,
              );
            }
          }
        });

        document.getElementById("hostsCount").textContent =
          `${hosts.length} hosts`;

        tbody.innerHTML = hosts
          .map((h, i) => {
            const techs = (h.technologies || [])
              .map((t) => `<span class="tech-badge">${escapeHtml(t)}</span>`)
              .join("");

            // Get IPs from multiple sources
            let ipList = [];

            // 1. From node's ips array
            if (h.ips && Array.isArray(h.ips)) {
              ipList = ipList.concat(h.ips);
            }

            // 2. From node's ip field
            if (h.ip) {
              ipList.push(h.ip);
            }

            // 3. From node's address field
            if (h.address) {
              ipList.push(h.address);
            }

            // 4. From link map
            const hostKey = h.hostname || h.label;
            if (hostIpMap[hostKey]) {
              ipList = ipList.concat(Array.from(hostIpMap[hostKey]));
            }

            // 5. Try to extract from headers (like cf-connecting-ip, x-real-ip)
            if (h.headers && Array.isArray(h.headers)) {
              h.headers.forEach((hdr) => {
                if (hdr.key && hdr.value) {
                  const key = hdr.key.toLowerCase();
                  if (
                    key === "x-served-by" ||
                    key === "x-cache" ||
                    key === "x-amz-cf-id"
                  ) {
                    // These may contain server identifiers, not IPs
                  }
                }
              });
            }

            // Remove duplicates
            ipList = [...new Set(ipList.filter((ip) => ip && isValidIP(ip)))];

            const ips = ipList
              .map(
                (ip) =>
                  `<span class="ip-badge" onclick="copyToClipboard('${escapeHtml(ip)}')">${escapeHtml(ip)}</span>`,
              )
              .join("");

            const statusClass = h.status ? `status-${h.status}` : "status-null";

            return `
            <tr data-type="${h.type}" data-status="${h.status || ""}" style="animation-delay: ${i * 0.05}s">
              <td><strong>${escapeHtml(h.hostname || h.label)}</strong></td>
              <td><span class="type-indicator"><span class="type-dot" style="color: ${getNodeColor(h.role || h.type)}"></span>${h.role || h.type}</span></td>
              <td><span class="status-badge ${statusClass}">â— ${h.status || "N/A"}</span></td>
              <td>${techs || '<span style="color:#666">â€”</span>'}</td>
              <td>${ips || '<span style="color:#666">â€”</span>'}</td>
            </tr>
          `;
          })
          .join("");
      }

      function populateTechPanel(nodes) {
        const panel = document.getElementById("techPanel");
        const techSet = new Set();
        nodes.forEach((n) =>
          (n.technologies || []).forEach((t) => techSet.add(t)),
        );
        const techs = Array.from(techSet).sort();

        document.getElementById("techCount").textContent =
          `${techs.length} technologies`;

        if (techs.length === 0) {
          panel.innerHTML =
            '<div style="text-align:center;color:#666;padding:20px;">No technologies detected</div>';
          return;
        }

        panel.innerHTML = techs
          .map(
            (t) =>
              `<span class="tech-badge" onclick="handleSearch('${escapeHtml(t)}')">${escapeHtml(t)}</span>`,
          )
          .join("");
      }

      function populateIpPanel(nodes) {
        const panel = document.getElementById("ipPanel");
        const ipSet = new Set();

        nodes.forEach((n) => {
          // Check ips array
          if (n.ips && Array.isArray(n.ips)) {
            n.ips.forEach((ip) => ipSet.add(ip));
          }

          // Check if node itself is an IP type
          if (n.type === "ip" && n.label) {
            ipSet.add(n.label);
          }

          // Check ip field directly
          if (n.ip) {
            ipSet.add(n.ip);
          }

          // Check address field
          if (n.address) {
            ipSet.add(n.address);
          }

          // Extract IPs from headers (like x-forwarded-for, etc.)
          if (n.headers && Array.isArray(n.headers)) {
            n.headers.forEach((hdr) => {
              if (hdr.key && hdr.value) {
                const key = hdr.key.toLowerCase();
                // Check common IP-related headers
                if (
                  key === "x-forwarded-for" ||
                  key === "x-real-ip" ||
                  key === "cf-connecting-ip" ||
                  key === "x-client-ip" ||
                  key === "true-client-ip"
                ) {
                  // Extract IPs from header value (may be comma-separated)
                  const ipsInHeader = hdr.value
                    .split(",")
                    .map((ip) => ip.trim());
                  ipsInHeader.forEach((ip) => {
                    // Validate it looks like an IP
                    if (isValidIP(ip)) {
                      ipSet.add(ip);
                    }
                  });
                }
              }
            });
          }
        });

        const ips = Array.from(ipSet).sort((a, b) => {
          // Sort IPs numerically
          const aParts = a.split(".").map(Number);
          const bParts = b.split(".").map(Number);
          for (let i = 0; i < 4; i++) {
            if (aParts[i] !== bParts[i]) {
              return (aParts[i] || 0) - (bParts[i] || 0);
            }
          }
          return 0;
        });

        document.getElementById("ipCount").textContent = `${ips.length} IPs`;

        if (ips.length === 0) {
          panel.innerHTML =
            '<div style="text-align:center;color:#666;padding:20px;">ðŸ“ No IP addresses resolved</div>';
          return;
        }

        panel.innerHTML = ips
          .map(
            (ip) =>
              `<span class="ip-badge" onclick="copyToClipboard('${escapeHtml(ip)}')" title="Click to copy">ðŸ“ ${escapeHtml(ip)}</span>`,
          )
          .join("");
      }

      // Helper function to validate IP address format
      function isValidIP(str) {
        if (!str || typeof str !== "string") return false;

        // IPv4 pattern
        const ipv4Pattern = /^(\d{1,3}\.){3}\d{1,3}$/;
        if (ipv4Pattern.test(str)) {
          const parts = str.split(".");
          return parts.every((part) => {
            const num = parseInt(part, 10);
            return num >= 0 && num <= 255;
          });
        }

        // IPv6 pattern (simplified)
        const ipv6Pattern =
          /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::$|^([0-9a-fA-F]{1,4}:){1,7}:$|^::[0-9a-fA-F]{1,4}(:[0-9a-fA-F]{1,4}){0,6}$/;
        if (ipv6Pattern.test(str)) {
          return true;
        }

        return false;
      }

      function populateSecurityTable(nodes) {
        const tbody = document.getElementById("securityTable");
        const hosts = nodes.filter(
          (n) => n.type === "host" && n.headers && n.headers.length > 0,
        );

        let totalScore = 0;

        tbody.innerHTML = hosts
          .map((h, i) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const hsts = headers["strict-transport-security"];
            const csp = headers["content-security-policy"];
            const xfo = headers["x-frame-options"];
            const xcto = headers["x-content-type-options"];
            const xxss = headers["x-xss-protection"];

            let score = 0;
            if (hsts) score += 20;
            if (csp) score += 30;
            if (xfo) score += 20;
            if (xcto) score += 15;
            if (xxss) score += 15;

            totalScore += score;

            const badge = (val, name) =>
              val
                ? `<span class="security-badge security-good" title="${escapeHtml(val)}">âœ“ ${name}</span>`
                : `<span class="security-badge security-bad">âœ— ${name}</span>`;

            return `
            <tr style="animation-delay: ${i * 0.05}s">
              <td><strong>${escapeHtml(h.hostname)}</strong></td>
              <td>${badge(hsts, "HSTS")}</td>
              <td>${badge(csp, "CSP")}</td>
              <td>${badge(xfo, "X-Frame")}</td>
              <td>${badge(xcto, "X-Content")}</td>
              <td>${badge(xxss, "X-XSS")}</td>
              <td><span class="status-badge ${score >= 70 ? "status-200" : score >= 40 ? "status-301" : "status-403"}">${score}%</span></td>
            </tr>
          `;
          })
          .join("");

        const avgScore = hosts.length
          ? Math.round(totalScore / hosts.length)
          : 0;
        document.getElementById("securityScore").textContent =
          `${avgScore}% avg`;
      }

      // Infrastructure & CDN Detection
      function populateInfrastructureTable(nodes) {
        const tbody = document.getElementById("infraTable");
        const hostsWithHeaders = nodes.filter(
          (n) => n.type === "host" && n.headers && n.headers.length > 0,
        );

        let infraCount = 0;

        const rows = hostsWithHeaders
          .map((h, i) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const server = headers["server"] || "";
            const cfRay = headers["cf-ray"] || "";
            const via = headers["via"] || "";

            // Detect CDN/Proxy
            let cdnInfo = [];
            if (cfRay || server.toLowerCase().includes("cloudflare")) {
              cdnInfo.push({
                name: "Cloudflare",
                class: "cdn-cloudflare",
                icon: "â˜ï¸",
              });
            }
            if (
              server.toLowerCase().includes("google") ||
              server.toLowerCase().includes("gws") ||
              server.toLowerCase().includes("gfe")
            ) {
              cdnInfo.push({ name: "Google", class: "cdn-google", icon: "ðŸ”·" });
            }
            if (
              server.toLowerCase().includes("amazon") ||
              server.toLowerCase().includes("cloudfront") ||
              server.toLowerCase().includes("aws")
            ) {
              cdnInfo.push({ name: "AWS", class: "cdn-aws", icon: "ðŸ“¦" });
            }
            if (server.toLowerCase().includes("akamai")) {
              cdnInfo.push({ name: "Akamai", class: "cdn-akamai", icon: "ðŸŒŠ" });
            }
            if (server.toLowerCase().includes("fastly")) {
              cdnInfo.push({ name: "Fastly", class: "cdn-fastly", icon: "âš¡" });
            }
            if (server.toLowerCase().includes("nginx")) {
              cdnInfo.push({ name: "nginx", class: "cdn-nginx", icon: "ðŸŸ¢" });
            }
            if (server.toLowerCase().includes("apache")) {
              cdnInfo.push({ name: "Apache", class: "cdn-apache", icon: "ðŸª¶" });
            }

            // Envoy detection
            const envoyHeaders = Object.keys(headers).filter((k) =>
              k.startsWith("x-envoy"),
            );
            const envoyInfo =
              envoyHeaders.length > 0
                ? envoyHeaders.map((k) => `${k}: ${headers[k]}`).join("; ")
                : "";
            if (envoyInfo) {
              cdnInfo.push({ name: "Envoy", class: "cdn-envoy", icon: "ðŸ”€" });
            }

            if (server || cfRay || envoyInfo || via) infraCount++;

            const cdnBadges =
              cdnInfo.length > 0
                ? cdnInfo
                    .map(
                      (c) =>
                        `<span class="cdn-badge ${c.class}">${c.icon} ${c.name}</span>`,
                    )
                    .join("")
                : '<span style="color:#666">â€”</span>';

            return `
            <tr style="animation-delay: ${i * 0.03}s">
              <td><strong>${escapeHtml(h.hostname)}</strong></td>
              <td><span class="cdn-badge cdn-default">${escapeHtml(server) || "â€”"}</span></td>
              <td>${cdnBadges}</td>
              <td><span style="font-family: monospace; font-size: 0.8rem; color: #f58220;">${escapeHtml(cfRay) || "â€”"}</span></td>
              <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; font-size: 0.75rem; color: #ac6eff;">${escapeHtml(envoyInfo) || "â€”"}</td>
              <td style="font-size: 0.8rem; color: #888;">${escapeHtml(via) || "â€”"}</td>
            </tr>
          `;
          })
          .join("");

        tbody.innerHTML =
          rows ||
          '<tr><td colspan="6" style="text-align:center;color:#666;padding:30px;">No infrastructure data available</td></tr>';
        document.getElementById("infraCount").textContent =
          `${infraCount} detected`;
      }

      // HSTS Details
      function populateHSTSTable(nodes) {
        const tbody = document.getElementById("hstsTable");
        const hostsWithHSTS = [];

        nodes
          .filter((n) => n.type === "host" && n.headers)
          .forEach((h) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const hsts = headers["strict-transport-security"];
            if (hsts) {
              const maxAgeMatch = hsts.match(/max-age=(\d+)/i);
              const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1]) : null;
              const includeSubdomains = hsts
                .toLowerCase()
                .includes("includesubdomains");
              const preload = hsts.toLowerCase().includes("preload");

              hostsWithHSTS.push({
                hostname: h.hostname,
                maxAge,
                maxAgeRaw: hsts,
                includeSubdomains,
                preload,
              });
            }
          });

        document.getElementById("hstsCount").textContent =
          `${hostsWithHSTS.length} hosts`;

        const formatDuration = (seconds) => {
          if (!seconds) return "â€”";
          const days = Math.floor(seconds / 86400);
          const years = Math.floor(days / 365);
          if (years >= 1) return `${years}y ${days % 365}d`;
          if (days >= 1) return `${days} days`;
          return `${seconds}s`;
        };

        const getDurationClass = (seconds) => {
          if (!seconds) return "hsts-weak";
          if (seconds >= 31536000) return "hsts-strong";
          if (seconds >= 2592000) return "hsts-medium";
          return "hsts-weak";
        };

        tbody.innerHTML =
          hostsWithHSTS
            .map(
              (h, i) => `
          <tr style="animation-delay: ${i * 0.03}s">
            <td><strong>${escapeHtml(h.hostname)}</strong></td>
            <td><span class="hsts-duration ${getDurationClass(h.maxAge)}" title="${h.maxAge ? h.maxAge + " seconds" : "Not set"}">â±ï¸ ${formatDuration(h.maxAge)}</span></td>
            <td>${h.includeSubdomains ? '<span class="security-badge security-good">âœ“ Yes</span>' : '<span class="security-badge security-warning">âœ— No</span>'}</td>
            <td>${h.preload ? '<span class="security-badge security-good">âœ“ Yes</span>' : '<span class="security-badge security-warning">âœ— No</span>'}</td>
          </tr>
        `,
            )
            .join("") ||
          '<tr><td colspan="4" style="text-align:center;color:#666;padding:30px;">No HSTS headers found</td></tr>';
      }

      // HTTP/3 & Alt-Svc
      function populateAltSvcTable(nodes) {
        const tbody = document.getElementById("altSvcTable");
        const hostsWithAltSvc = [];

        nodes
          .filter((n) => n.type === "host" && n.headers)
          .forEach((h) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const altSvc = headers["alt-svc"];
            if (altSvc) {
              const protocols = [];
              if (altSvc.includes("h3")) protocols.push("HTTP/3");
              if (altSvc.includes("h2")) protocols.push("HTTP/2");
              if (altSvc.includes("quic")) protocols.push("QUIC");

              hostsWithAltSvc.push({
                hostname: h.hostname,
                altSvc,
                protocols,
              });
            }
          });

        document.getElementById("altSvcCount").textContent =
          `${hostsWithAltSvc.length} hosts`;

        tbody.innerHTML =
          hostsWithAltSvc
            .map((h, i) => {
              const protocolBadges = h.protocols
                .map((p) => {
                  const cls =
                    p === "HTTP/3"
                      ? "protocol-h3"
                      : p === "QUIC"
                        ? "protocol-quic"
                        : "protocol-h2";
                  const icon =
                    p === "HTTP/3" ? "âš¡" : p === "QUIC" ? "ðŸš€" : "ðŸ”·";
                  return `<span class="protocol-badge ${cls}">${icon} ${p}</span>`;
                })
                .join(" ");

              return `
            <tr style="animation-delay: ${i * 0.03}s">
              <td><strong>${escapeHtml(h.hostname)}</strong></td>
              <td>${protocolBadges || "â€”"}</td>
              <td style="font-family: monospace; font-size: 0.75rem; max-width: 300px; overflow: hidden; text-overflow: ellipsis;" title="${escapeHtml(h.altSvc)}">${escapeHtml(h.altSvc.substring(0, 80))}${h.altSvc.length > 80 ? "..." : ""}</td>
            </tr>
          `;
            })
            .join("") ||
          '<tr><td colspan="3" style="text-align:center;color:#666;padding:30px;">No Alt-Svc headers found</td></tr>';
      }

      // CORS Analysis
      function populateCORSTable(nodes) {
        const tbody = document.getElementById("corsTable");
        const hostsWithCORS = [];

        nodes
          .filter((n) => n.type === "host" && n.headers)
          .forEach((h) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const corsHeaders = {
              allowOrigin: headers["access-control-allow-origin"],
              allowMethods: headers["access-control-allow-methods"],
              allowHeaders: headers["access-control-allow-headers"],
              allowCredentials: headers["access-control-allow-credentials"],
              exposeHeaders: headers["access-control-expose-headers"],
              maxAge: headers["access-control-max-age"],
            };

            if (Object.values(corsHeaders).some((v) => v)) {
              hostsWithCORS.push({
                hostname: h.hostname,
                ...corsHeaders,
              });
            }
          });

        document.getElementById("corsCount").textContent =
          `${hostsWithCORS.length} hosts`;

        const formatCorsValue = (value, isOrigin = false) => {
          if (!value) return '<span style="color:#666">â€”</span>';
          const isWildcard = value.trim() === "*";
          const cls = isOrigin
            ? isWildcard
              ? "cors-wildcard"
              : "cors-restricted"
            : "";
          return `<span class="cors-value ${cls}" onclick="copyToClipboard('${escapeHtml(value)}')" title="${escapeHtml(value)}">${isWildcard && isOrigin ? "âš ï¸ " : ""}${escapeHtml(value)}</span>`;
        };

        tbody.innerHTML =
          hostsWithCORS
            .map(
              (h, i) => `
          <tr style="animation-delay: ${i * 0.03}s">
            <td><strong>${escapeHtml(h.hostname)}</strong></td>
            <td>${formatCorsValue(h.allowOrigin, true)}</td>
            <td>${formatCorsValue(h.allowMethods)}</td>
            <td>${formatCorsValue(h.allowHeaders)}</td>
            <td>${h.allowCredentials ? '<span class="security-badge security-warning">âš ï¸ true</span>' : '<span style="color:#666">â€”</span>'}</td>
            <td>${formatCorsValue(h.exposeHeaders)}</td>
            <td>${h.maxAge ? `<span style="font-family:monospace;font-size:0.8rem;">${h.maxAge}s</span>` : '<span style="color:#666">â€”</span>'}</td>
          </tr>
        `,
            )
            .join("") ||
          '<tr><td colspan="7" style="text-align:center;color:#666;padding:30px;">No CORS headers found</td></tr>';
      }

      // Cache & ETag Analysis
      function populateCacheTable(nodes) {
        const tbody = document.getElementById("cacheTable");
        const hostsWithCache = [];

        nodes
          .filter((n) => n.type === "host" && n.headers)
          .forEach((h) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const cacheControl = headers["cache-control"];
            const etag = headers["etag"];
            const lastModified = headers["last-modified"];

            if (cacheControl || etag || lastModified) {
              hostsWithCache.push({
                hostname: h.hostname,
                cacheControl,
                etag,
                lastModified,
              });
            }
          });

        document.getElementById("cacheCount").textContent =
          `${hostsWithCache.length} hosts`;

        tbody.innerHTML =
          hostsWithCache
            .map(
              (h, i) => `
          <tr style="animation-delay: ${i * 0.03}s">
            <td><strong>${escapeHtml(h.hostname)}</strong></td>
            <td><span class="cache-value" title="${escapeHtml(h.cacheControl || "")}">${escapeHtml(h.cacheControl || "â€”")}</span></td>
            <td><span class="etag-value" onclick="copyToClipboard('${escapeHtml(h.etag || "")}')" style="cursor:pointer" title="Click to copy">${escapeHtml((h.etag || "â€”").substring(0, 30))}${(h.etag || "").length > 30 ? "..." : ""}</span></td>
            <td style="font-size: 0.8rem; color: #888;">${escapeHtml(h.lastModified || "â€”")}</td>
          </tr>
        `,
            )
            .join("") ||
          '<tr><td colspan="4" style="text-align:center;color:#666;padding:30px;">No cache headers found</td></tr>';
      }

      // Client Hints & Permissions Policy
      function populateClientHintsTable(nodes) {
        const tbody = document.getElementById("hintsTable");
        const hostsWithHints = [];

        nodes
          .filter((n) => n.type === "host" && n.headers)
          .forEach((h) => {
            const headers = {};
            (h.headers || []).forEach((hdr) => {
              if (hdr.key) headers[hdr.key.toLowerCase()] = hdr.value;
            });

            const acceptCH = headers["accept-ch"];
            const permissionsPolicy =
              headers["permissions-policy"] || headers["feature-policy"];

            if (acceptCH || permissionsPolicy) {
              hostsWithHints.push({
                hostname: h.hostname,
                acceptCH,
                permissionsPolicy,
              });
            }
          });

        document.getElementById("hintsCount").textContent =
          `${hostsWithHints.length} hosts`;

        const formatClientHints = (hints) => {
          if (!hints) return '<span style="color:#666">â€”</span>';
          const items = hints.split(",").map((h) => h.trim());
          return (
            items
              .slice(0, 5)
              .map(
                (item) =>
                  `<span class="permission-item">${escapeHtml(item)}</span>`,
              )
              .join("") +
            (items.length > 5
              ? `<span class="permission-item">+${items.length - 5} more</span>`
              : "")
          );
        };

        const formatPermissions = (policy) => {
          if (!policy) return '<span style="color:#666">â€”</span>';
          const items = policy.split(",").map((p) => p.trim());
          return (
            items
              .slice(0, 4)
              .map((item) => {
                const isBlocked =
                  item.includes("()") || item.includes("'none'");
                return `<span class="permission-item ${isBlocked ? "permission-blocked" : "permission-allowed"}">${escapeHtml(item.substring(0, 25))}${item.length > 25 ? "..." : ""}</span>`;
              })
              .join("") +
            (items.length > 4
              ? `<span class="permission-item">+${items.length - 4} more</span>`
              : "")
          );
        };

        tbody.innerHTML =
          hostsWithHints
            .map(
              (h, i) => `
          <tr style="animation-delay: ${i * 0.03}s">
            <td><strong>${escapeHtml(h.hostname)}</strong></td>
            <td>${formatClientHints(h.acceptCH)}</td>
            <td>${formatPermissions(h.permissionsPolicy)}</td>
          </tr>
        `,
            )
            .join("") ||
          '<tr><td colspan="3" style="text-align:center;color:#666;padding:30px;">No client hints or permissions policy found</td></tr>';
      }

      function populateCookiesPanel(nodes) {
        const panel = document.getElementById("cookiesPanel");
        const allCookies = [];

        nodes.forEach((n) => {
          // Handle cookies array if present
          if (n.cookies && Array.isArray(n.cookies)) {
            n.cookies.forEach((c) => {
              allCookies.push({ ...c, host: n.hostname || n.label });
            });
          }

          // Parse cookies from set-cookie header
          if (n.headers && Array.isArray(n.headers)) {
            n.headers.forEach((hdr) => {
              if (
                hdr.key &&
                hdr.key.toLowerCase() === "set-cookie" &&
                hdr.value
              ) {
                // set-cookie can contain multiple cookies separated by comma (but be careful with expires)
                // Split by comma but not within date strings
                const cookieStrings = hdr.value.split(/,(?=\s*[^;]+=[^;]+)/);

                cookieStrings.forEach((cookieStr) => {
                  const cookie = parseCookie(cookieStr, n.hostname || n.label);
                  if (cookie) {
                    allCookies.push(cookie);
                  }
                });
              }
            });
          }

          // Also check if node itself is a cookie type
          if (n.type === "cookie") {
            allCookies.push({
              name: n.name || n.label,
              value: n.value || "",
              secure: n.secure,
              httpOnly: n.httpOnly,
              sameSite: n.sameSite,
              path: n.path,
              host: n.hostname || n.host || "Unknown",
            });
          }
        });

        document.getElementById("cookieCount").textContent =
          `${allCookies.length} cookies`;

        if (allCookies.length === 0) {
          panel.innerHTML =
            '<div style="text-align:center;color:#666;padding:40px;">ðŸª No cookies detected in scan data</div>';
          return;
        }

        panel.innerHTML = allCookies
          .map(
            (c) => `
          <div class="cookie-item">
            <div class="cookie-name">
              <span>ðŸª ${escapeHtml(c.name || "Unknown")}</span>
              <span style="font-size: 0.8rem; color: #888;">${escapeHtml(c.host)}</span>
            </div>
            <div style="font-family: monospace; font-size: 0.75rem; color: #666; margin-bottom: 8px; word-break: break-all;">
              ${escapeHtml((c.value || "").substring(0, 60))}${(c.value || "").length > 60 ? "..." : ""}
            </div>
            <div class="cookie-flags">
              ${c.secure ? '<span class="security-badge security-good">ðŸ”’ Secure</span>' : '<span class="security-badge security-bad">âš ï¸ No Secure</span>'}
              ${c.httpOnly ? '<span class="security-badge security-good">ðŸ›¡ï¸ HttpOnly</span>' : '<span class="security-badge security-warning">âš ï¸ No HttpOnly</span>'}
              ${c.sameSite ? `<span class="security-badge security-info">SameSite: ${escapeHtml(c.sameSite)}</span>` : '<span class="security-badge security-warning">âš ï¸ No SameSite</span>'}
              ${c.path ? `<span class="security-badge security-info">Path: ${escapeHtml(c.path)}</span>` : ""}
              ${c.domain ? `<span class="security-badge security-info">Domain: ${escapeHtml(c.domain)}</span>` : ""}
              ${c.expires ? `<span class="security-badge security-info">Expires: ${escapeHtml(c.expires)}</span>` : ""}
              ${c.maxAge ? `<span class="security-badge security-info">Max-Age: ${escapeHtml(c.maxAge)}</span>` : ""}
            </div>
          </div>
        `,
          )
          .join("");
      }

      // Helper function to parse a single cookie string
      function parseCookie(cookieStr, host) {
        if (!cookieStr || typeof cookieStr !== "string") return null;

        const parts = cookieStr.split(";").map((p) => p.trim());
        if (parts.length === 0) return null;

        // First part is name=value
        const firstPart = parts[0];
        const eqIndex = firstPart.indexOf("=");
        if (eqIndex === -1) return null;

        const name = firstPart.substring(0, eqIndex).trim();
        const value = firstPart.substring(eqIndex + 1).trim();

        const cookie = {
          name,
          value,
          host,
          secure: false,
          httpOnly: false,
          sameSite: null,
          path: null,
          domain: null,
          expires: null,
          maxAge: null,
        };

        // Parse attributes
        for (let i = 1; i < parts.length; i++) {
          const part = parts[i].toLowerCase();
          const attrPart = parts[i]; // Keep original case for values

          if (part === "secure") {
            cookie.secure = true;
          } else if (part === "httponly") {
            cookie.httpOnly = true;
          } else if (part.startsWith("samesite=")) {
            cookie.sameSite = attrPart.substring(9).trim();
          } else if (part.startsWith("path=")) {
            cookie.path = attrPart.substring(5).trim();
          } else if (part.startsWith("domain=")) {
            cookie.domain = attrPart.substring(7).trim();
          } else if (part.startsWith("expires=")) {
            cookie.expires = attrPart.substring(8).trim();
          } else if (part.startsWith("max-age=")) {
            cookie.maxAge = attrPart.substring(8).trim();
          }
        }

        return cookie;
      }

      function populateHeadersPanel(nodes) {
        const panel = document.getElementById("headersPanel");
        const hostsWithHeaders = nodes.filter(
          (n) => n.headers && n.headers.length > 0,
        );

        if (hostsWithHeaders.length === 0) {
          panel.innerHTML =
            '<div style="text-align:center;color:#666;padding:40px;">ðŸ“‹ No header data available</div>';
          return;
        }

        panel.innerHTML = hostsWithHeaders
          .map(
            (h) => `
          <div style="padding: 14px 16px; background: rgba(247,147,30,0.1); border-bottom: 1px solid rgba(247,147,30,0.2);">
            <strong style="color: #f7931e;">ðŸ“¡ ${escapeHtml(h.hostname)}</strong>
            <span style="color: #666; font-size: 0.8rem; margin-left: 10px;">(${h.headers.length} headers)</span>
          </div>
          ${h.headers
            .map(
              (hdr) => `
            <div class="header-item">
              <div class="header-key">${escapeHtml(hdr.key || "")}</div>
              <div class="header-value">
                ${escapeHtml(String(hdr.value || "").substring(0, 200))}${(hdr.value || "").length > 200 ? "..." : ""}
                <button class="copy-btn" onclick="copyToClipboard(\`${escapeHtml(String(hdr.value || "").replace(/`/g, "\\`"))}\`)">ðŸ“‹</button>
              </div>
            </div>
          `,
            )
            .join("")}
        `,
          )
          .join("");
      }

      function populatePathsTable(nodes) {
        const tbody = document.getElementById("pathsTable");
        const paths = nodes.filter((n) =>
          ["path", "dir", "file", "endpoint", "url"].includes(n.type),
        );

        document.getElementById("pathCount").textContent =
          `${paths.length} paths`;

        if (paths.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="4" style="text-align:center;color:#666;padding:30px;">ðŸ“ No paths discovered</td></tr>';
          return;
        }

        tbody.innerHTML = paths
          .map(
            (p, i) => `
          <tr data-type="${p.type}" style="animation-delay: ${i * 0.02}s">
            <td><span class="type-indicator"><span class="type-dot" style="color: ${getNodeColor(p.type)}"></span>${escapeHtml(p.path || p.fullPath || p.label)}</span></td>
            <td><span style="color: ${getNodeColor(p.type)}">${p.type}</span></td>
            <td>${escapeHtml(p.hostname || p.host || "â€”")}</td>
            <td>${p.level ?? 0}</td>
          </tr>
        `,
          )
          .join("");
      }

      function populateAllNodesTable(nodes) {
        const tbody = document.getElementById("allNodesTable");

        document.getElementById("nodesCount").textContent =
          `${nodes.length} nodes`;

        tbody.innerHTML = nodes
          .map((n, i) => {
            const statusClass = n.status ? `status-${n.status}` : "status-null";
            return `
            <tr data-type="${n.type}" data-status="${n.status || ""}" style="animation-delay: ${i * 0.01}s">
              <td><span class="type-indicator"><span class="type-dot" style="color: ${getNodeColor(n.type)}"></span>${n.type}</span></td>
              <td><strong>${escapeHtml(n.label)}</strong></td>
              <td style="font-family: monospace; font-size: 0.8rem;">${escapeHtml(n.fullPath || n.path || n.hostname || "â€”")}</td>
              <td>${n.level || 0}</td>
              <td><span class="status-badge ${statusClass}">â— ${n.status || "N/A"}</span></td>
            </tr>
          `;
          })
          .join("");
      }

      function renderReport(data) {
        reportData = data;

        // Header info
        document.getElementById("targetName").textContent =
          data.target || "Unknown";
        document.getElementById("reportDate").textContent =
          `Generated: ${new Date(data.timestamp || Date.now()).toLocaleString()}`;
        document.getElementById("scanId").textContent =
          `Scan ID: ${data.scanId || Date.now().toString(36)}`;
        document.getElementById("footerDate").textContent =
          `Report generated on ${new Date().toLocaleString()}`;

        const nodes = data.graph?.nodes || [];
        const links = data.graph?.links || [];
        allNodes = nodes;

        if (nodes.length === 0) {
          document.getElementById("noData").style.display = "block";
          return;
        }

        // Summary
        populateSummaryCards(nodes, links);
        populateTimeline(data);
        calculateRiskScore(nodes);
        updateFilterCounts(nodes);

        // Charts
        const typeData = countByProperty(nodes, "type");

        // Fix: Only count nodes that actually have a status value
        const nodesWithStatus = nodes.filter(
          (n) => n.status !== undefined && n.status !== null,
        );
        const statusData = countByProperty(nodesWithStatus, "status");

        document.getElementById("typeCount").textContent =
          `${typeData.length} types`;
        document.getElementById("statusCount").textContent =
          `${nodesWithStatus.length} responses`;

        setTimeout(() => {
          drawDonutChart(
            document.getElementById("pieChart"),
            typeData,
            getNodeColor,
          );
          drawDonutChart(
            document.getElementById("statusChart"),
            statusData,
            getStatusColor,
          );
          createLegend(
            document.getElementById("chartLegend"),
            typeData,
            getNodeColor,
          );
          createLegend(
            document.getElementById("statusLegend"),
            statusData,
            getStatusColor,
          );
        }, 500);

        // Tables
        populateHostsTable(nodes, links);
        populateTechPanel(nodes);
        populateIpPanel(nodes);
        populateSecurityTable(nodes);

        // Infrastructure & advanced header analysis
        populateInfrastructureTable(nodes);
        populateHSTSTable(nodes);
        populateAltSvcTable(nodes);
        populateCORSTable(nodes);
        populateCacheTable(nodes);
        populateClientHintsTable(nodes);

        populateCookiesPanel(nodes);
        populateHeadersPanel(nodes);
        populatePathsTable(nodes);
        populateAllNodesTable(nodes);
      }

      // Initialize on DOM ready
      document.addEventListener("DOMContentLoaded", function () {
        // Create particles
        createParticles();

        // Initialize search
        initSearch();

        // Initialize navigation
        initNavigation();

        try {
          const rawData = localStorage.getItem("reportData");

          // Hide loading screen after a short delay
          setTimeout(() => {
            document.getElementById("loadingScreen").classList.add("hidden");
          }, 800);

          if (!rawData) {
            setTimeout(() => {
              document.getElementById("noData").style.display = "block";
            }, 900);
            return;
          }

          setTimeout(() => {
            renderReport(JSON.parse(rawData));
          }, 850);
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("loadingScreen").classList.add("hidden");
          document.getElementById("noData").style.display = "block";
          document.getElementById("noData").innerHTML = `
            <div class="no-data-icon">âš ï¸</div>
            <div>Error loading report</div>
            <div style="font-size: 0.9rem; margin-top: 10px; color: #f44336;">${error.message}</div>
          `;
        }
      });
    </script>
  </body>
</html>
